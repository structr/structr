/*
* Copyright (C) 2010-2016 Structr GmbH
*
* This file is part of Structr <http://structr.org>.
*
* Structr is free software: you can redistribute it and/or modify
* it under the terms of the GNU Affero General Public License as
* published by the Free Software Foundation, either version 3 of the
* License, or (at your option) any later version.
*
* Structr is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
* GNU Affero General Public License for more details.
*
* You should have received a copy of the GNU Affero General Public License
* along with Structr.  If not, see <http://www.gnu.org/licenses/>.
*/
var Graphbrowser=Graphbrowser||{};Graphbrowser.Control=Graphbrowser.Control||{},function(){"use strict";Graphbrowser.Control.SigmaControl=function(a,b){function c(){sigma.renderers.def=sigma.renderers.canvas,F=new sigma({container:J,settings:I}),M=sigma.plugins.activeState(F),O=sigma.plugins.keyboard(F,F.renderers[0]),P=sigma.plugins.select(F,M),L=new sigma.plugins.dragNodes(F,F.renderers[0],M),N=new sigma.plugins.lasso(F,F.renderers[0],K),P.bindKeyboard(O),P.bindLasso(N),g(),$(window).keyup(e),$(window).on("keydown",f),G.sigmaCtrl={},G.sigmaPlugins={},G.sigmaCtrl.unbindSigmaEvent=i,G.sigmaCtrl.bindSigmaEvent=j,G.sigmaCtrl.addNode=k,G.sigmaCtrl.addEdge=l,G.sigmaPlugins.activeState=M,G.sigmaPlugins.keyboard=O,G.sigmaPlugins.select=P,G.sigmaPlugins.lasso=N;for(var a in H)G.api[a]=H[a];return F}function d(){$(window).unbind("keyup",e),$(window).unbind("keydown",f),V=[],W=[],F.kill(),F=void 0}function e(a){switch(a.which){case 16:S=!1;break;case 17:T=!1;break;case 18:U=!1;break;default:return!1}for(var b=S||U||T,c=0;c<V.length;c++)V[c]({shiftKey:S,ctrlKey:T,altKey:U,noKey:!b})}function f(a){switch(27===a.keyCode&&a.preventDefault(),a.which){case 16:S=!0;break;case 17:T=!0;break;case 18:U=!0}for(var b=S||U||T,c=0;c<W.length;c++)W[c]({shiftKey:S,ctrlKey:T,altKey:U,noKey:!b})}function g(){R=!0}function h(a,b){H=H||{},H[a]=b}function i(a,b){if("string"==typeof a&&"function"==typeof b){if("keyup"===a){var c=V.indexOf(b);V.splice(c,1)}if("keydown"===a){var c=W.indexOf(b);W.splice(c,1)}a.includes("drag")?L.unbind(a,b):F.unbind(a,b)}}function j(a,b){"string"==typeof a&&"function"==typeof b&&("keyup"===a&&V.push(b),"keydown"===a&&W.push(b),a.includes("drag")?L.bind(a,b):F.bind(a,b))}function k(a){if("string"==typeof a)F.graph.addNode({id:a,label:"",color:F.settings("defaultNodeColor"),size:F.settings("defaultNodeSize")});else{for(var b in X[a.nodeType])a[b]=X[a.nodeType][b];F.graph.addNode(a)}F.refresh()}function l(a,b,c){if(void 0!==b&&void 0!==c&&"string"==typeof a)F.graph.addEdge({id:a,source:b,target:c,color:F.settings("defaultEdgeColor"),size:F.settings("defaultEdgeSize")});else if("object"==typeof a){for(var d in Y[a.relType])a[d]=Y[a.relType][d];F.graph.addEdge(a)}F.refresh()}function m(a){"string"==typeof a?F.graph.nodes(a)&&F.graph.dropNode(a):F.graph.nodes(a.id)&&F.graph.dropNode(a.id),F.refresh()}function n(a,b){b?$.each(F.graph.nodes(),function(b,c){a.indexOf(c.id)<0&&F.graph.dropNode(c)}):$.each(F.graph.nodes(),function(b,c){a.indexOf(c.id)>=0&&F.graph.dropNode(c)}),F.refresh()}function o(a){"string"==typeof a?F.graph.edges(a)&&F.graph.dropEdge(a):F.graph.edges(a.id)&&F.graph.dropEdge(a.id),F.refresh()}function p(a,b){b?$.each(F.graph.edges(),function(b,c){a.indexOf(c.id)<0&&F.graph.dropEdge(c)}):$.each(F.graph.edges(),function(b,c){a.indexOf(c.id)>=0&&F.graph.dropEdge(c)}),F.refresh()}function q(a){F.graph.nodes(a)?F.graph.dropNode(a):F.graph.edges(a)&&F.graph.dropEdge(a),F.refresh()}function r(a,b,c,d){var e=F.graph.nodes(a);if(void 0!==e){if(c)c.forEach(function(a,c){e[a]=b[a]});else for(var f in b)e[f]=b[f];if("object"==typeof d)for(var g in d)e[g]=e[d[g]];F.refresh({skipIndexation:!1})}}function s(a,b,c,d){var e=F.graph.edges(a);if(void 0!==e){if(c)c.forEach(function(a,c){e[a]=b[a]});else for(var f in b)e[f]=b[f];if("object"==typeof d)for(var g in d)e[g]=e[d[g]];F.refresh({skipIndexation:!1})}}function t(){return F.camera.ratio}function u(){return F.graph.nodes()}function v(){return F.graph.edges()}function w(a){var b;return b="string"==typeof a?F.graph.nodes(a):F.graph.nodes(a.id),b?b:null}function x(a){var b;return b="string"==typeof a?F.graph.edges(a):F.graph.edges(a.id),b?b:null}function y(a,b,c){var d=[];return F.graph.edges().forEach(function(e){e.source!==a||e.target!==b||c&&e.relType!==c||d.push(e)}),d}function z(a,b){"string"==typeof a&&(F.settings(a,b),F.refresh({skipIndexation:!0}))}function A(a,b){if(F)return F}function B(a,b,c){var d=F.graph.nodes(a);return d[b]=c,F.refresh({skipIndexation:!0}),d}function C(a,b,c){var d=F.graph.edges(a);return d[b]=c,F.refresh({skipIndexation:!0}),d}function D(a,b,c,d){X[a]=X[a]||{},X[a][b]=c,d&&F.graph.nodes().forEach(function(a,b){for(var c in X[a.nodeType])a[c]=X[a.nodeType][c]}),F.refresh({skipIndexation:!0})}function E(a,b,c,d){Y[a]=Y[a]||{},Y[a][b]=c,d&&F.graph.edges().forEach(function(a,b){for(var c in Y[a.relType])a[c]=Y[a.edgeType][c]}),F.refresh({skipIndexation:!0})}var F,G,H,I,J,K,L,M,N,O,P,Q=this,R=!1,S=!1,T=!1,U=!1,V=[],W=[],X={},Y={},G=a;I=void 0!==b.sigmaSettings?b.sigmaSettings:{immutable:!1,minNodeSize:1,maxNodeSize:10,borderSize:4,defaultNodeBorderColor:"#a5a5a5",singleHover:!0,doubleClickEnabled:!1,minEdgeSize:4,maxEdgeSize:4,enableEdgeHovering:!0,edgeHoverColor:"default",edgeHoverSizeRatio:1.3,edgeHoverExtremities:!0,defaultEdgeColor:"#999",defaultEdgeHoverColor:"#888",minArrowSize:4,maxArrowSize:8,labelSize:"proportional",labelSizeRatio:1,labelAlignment:"right",nodeHaloColor:"rgba(236, 81, 72, 0.2)",nodeHaloSize:20},J=void 0!==b.graphContainer&&"string"==typeof b.graphContainer?b.graphContainer:"graph-container",K=void 0!==b.lassoSettings?b.lassoSettings:{strokeStyle:"rgb(236, 81, 72)",lineWidth:2,fillWhileDrawing:!0,fillStyle:"rgba(236, 81, 72, 0.2)",cursor:"crosshair"},h("unbindEvent",i),h("bindEvent",j),h("addNode",k),h("addEdge",l),h("dropNode",m),h("dropNodes",n),h("dropEdge",o),h("dropEdges",p),h("dropElement",q),h("updateNode",r),h("updateEdge",s),h("getCameraRatio",t),h("getNodes",u),h("getEdges",v),h("getNode",w),h("getEdge",x),h("findRelationships",y),h("changeSigmaSetting",z),h("getSigma",A),h("setNodeProperty",B),h("setEdgeProperty",C),h("setDefaultNodeTypeProperty",D),h("setDefaultEdgeTypeProperty",E),Q.init=c,Q.kill=d}}();var Graphbrowser=Graphbrowser||{};Graphbrowser.Control=Graphbrowser.Control||{},function(){"use strict";Graphbrowser.Control.ConnectionControl=function(a){function b(a,b){h=h||{},h[a]=b}function c(){g.conn=g.conn||{};for(var a in h)g.conn[a]=h[a]}function d(a,b,c,d){var e=void 0;return window.domainOnly&&window.domainOnly===!0&&(a+="?domainOnly=true"),void 0===d&&(d="application/json"),("object"==typeof c||"string"==typeof c||$.isArray(c))&&(e=JSON.stringify(c)),$.ajax({url:a,data:e||c,contentType:d,method:b})}function e(a,b,c,d){a.done(function(a,d){b(a.result,c)}).fail(function(a,b,e){console.log("Graph-Browser-Rest: Status "+a.status+" - ERROR: "+e),d&&d(c,a.responseJSON.message)})}function f(a,b,c,d){a.done(function(a,d){b(a,c)}).fail(function(a,b,e){console.log("Graph-Browser-Rest: Status "+a.status+" - ERROR: "+e),d&&d(c,a.responseJSON.message)})}var g=a,h={};b("getNodes",function(a,b,c,f){f||(f="_graph");var g="/structr/rest/"+a.id+"/"+b+"/"+f,h=d(g,"GET");e(h,c,a)}),b("getData",function(a,b,c,f){var g,h="/structr/rest/";void 0===f&&(f="_graph"),$.isArray(a)?(h+="resolver",g="POST"):(h+=a.id+"/"+f,g="GET");var i=d(h,g,"POST"===g?a:void 0);e(i,c,b)}),b("getGraphViews",function(a,b,c){var f="/structr/rest/GraphView/"+b+"/?viewSource="+a,g=d(f,"GET");e(g,c)}),b("getGraphViewData",function(a,b,c){var f="/structr/rest/GraphView/"+b+"/"+a,g=d(f,"GET");e(g,c)}),b("saveGraphView",function(a,b,c,f,g){var h={name:a,graph:b,data:c,viewSource:f},i="/structr/rest/GraphView",j=d(i,"POST",h,"application/json; charset=utf-8");e(j,g)}),b("getSchemaInformation",function(a){var b="/structr/rest/_schema/",c=d(b,"GET");e(c,a)}),b("getRelationshipsOfType",function(a,b,c){var f="/structr/rest/"+a,g=d(f,"GET");e(g,b,void 0,c)}),b("init",function(a,b,c){var f="/structr/rest/"+a,g=d(f,"GET");e(g,b,void 0,c)}),b("deleteRelationship",function(a,b){var c="/structr/rest/"+a,f=d(c,"DELETE");e(f,b)}),b("createRelationship",function(a,b,c,f,g,h){var i={sourceId:a,targetId:b},j="/structr/rest/"+c,k=d(j,"POST",i);e(k,f,g,h)}),b("getStructrPage",function(a,b,c,e){var g="/"+a+"/"+b,h=d(g,"GET");f(h,c,b,e)}),this.init=c}}.call(window);var Graphbrowser=Graphbrowser||{};Graphbrowser.Control=Graphbrowser.Control||{},function(){"use strict";Graphbrowser.Control.ModuleControl=function(a,b,c){function d(){Graphbrowser.Modules&&$.each(Graphbrowser.Modules,function(a,b){var c=new b(r,s);c.init(v[c.name]),t[c.name]=c})}function e(a,b){w[a]=w[a]||[],w[a].push(b)}function f(){x[r.id].unbind("dataChanged",i),x[r.id].unbind("prepareSaveGraph",n),x[r.id].unbind("restoreGraph",o),x[r.id].unbind("pickNodes",j),x[r.id].dispatchEvent("kill"),window.clearTimeout(u);for(var a=0;a<t.length;a++)t[a]=void 0}function g(){x[r.id].dispatchEvent("dataChanged")}function h(a){$.each(w.start,function(b,c){c(a)}),i()}function i(){window.clearTimeout(u),u=window.setTimeout(function(){r.refresh({skipIndexation:!1})},50)}function j(a){var b=a.data.nodesToSelect,c=a.data.onNodesSelected,d=a.data.parentNode,e=a.data.parentTitle,f=w.pickNodes;return f?void $.each(f,function(a,f){f(b,c,d,e)}):void c(b,d)}function k(a,b){var c=w.filterNodes;return $.each(c,function(c,d){a=d(a,b)}),a}function l(){var a=w.undo;a&&$.each(a,function(a,b){b()})}function m(a,b){var c=w.doLayout;"string"==typeof a&&c&&$.each(c,function(c,d){d(a,b)})}function n(a){var b=a.data.saveAsName,c=w.saveGraph;c||(c=[]);var d={name:b};$.each(c,function(a,b){var c=b();d[c.name]=c.data}),x[r.id].dispatchEvent("saveGraph",d)}function o(a){var b=a.data,c=w.restoreGraph;c&&$.each(c,function(a,c){c(b)})}function p(){var a={},b=w.status;return $.each(b,function(b,c){a[module.name]=c()}),a}function q(){var a=w.reset;a&&$.each(a,function(a,b){b()})}var r=c,s=a,t={},u=0,v=b,w={},x={};x[r.id]={},sigma.classes.dispatcher.extend(x[r.id]),s.eventEmitter=x,x[r.id].bind("dataChanged",i),x[r.id].bind("prepareSaveGraph",n),x[r.id].bind("restoreGraph",o),x[r.id].bind("pickNodes",j),s.bindBrowserEvent=e,s.refreshSigma=i,s.filterNodes=k,s.undo=l,s.doLayout=m,s.api.dataChanged=g,s.api.doLayout=m,s.api.refresh=i,s.api.start=h,s.api.status=p,s.api.reset=q,this.init=d,this.kill=f}}(),function(a){"use strict";Graphbrowser=Graphbrowser||{};var b=function(b){function c(){e.ModuleControl.kill(),e.sigmaControl.kill(),delete e.sigmaControl,delete e.ModuleControl}var d,e={},f={};if(b===a)throw new Error("Graph-Browser: No settings specified!");if(b.sigmaSettings===a&&console.log("Graph-Browser: No settings for Sigma.js found. Starting with default."),b.moduleSettings===a)throw new Error("Graph-Browser: Settings for Graph-Browser-Modules are missing!");f.api=f.api||{},e.sigmaControl=new Graphbrowser.Control.SigmaControl(f,b),d=e.sigmaControl.init(),e.connectionControl=new Graphbrowser.Control.ConnectionControl(f),e.connectionControl.init(),e.ModuleControl=new Graphbrowser.Control.ModuleControl(f,b.moduleSettings,d),e.ModuleControl.init();for(var g in f.api)this[g]=f.api[g];this.kill=c};this.GraphBrowser=b}.call(this);var Graphbrowser=Graphbrowser||{};Graphbrowser.Modules=Graphbrowser.Modules||{},function(){"use strict";Graphbrowser.Modules.CurrentNodeTypes=function(a,b){function c(a,b){t=t||{},t[a]=b}function d(a){if(a){void 0!==a.container?f(a.container):v=!0,u=void 0!==a.classes?a.classes:"";for(var b in t)r.api[b]=t[b];r.eventEmitter[q.id].bind("dataChanged",g),r.eventEmitter[q.id].bind("start",e)}else v=!0}function e(){g()}function f(a){v=!1,"#"!==a.charAt(0)&&(a="#"+a),$(a).append('<div id="currentNodeTypes-displayTypes" class="currentNodeTypes-displayTypes"></div>')}function g(a){w=[],y=[];var b=$("#currentNodeTypes-displayTypes");b.empty(),$.each(q.graph.nodes(),function(a,b){0===w.length&&(b.hidden===!0&&x.push(b.nodeType),w.push(b.nodeType));var c=!1;$.each(w,function(a,d){if(b.nodeType===d)return c=!0,!1}),c||(b.hidden===!0&&x.push(b.nodeType),w.push(b.nodeType))}),$.each(q.graph.edges(),function(a,b){0===y.length&&(b.hidden===!0&&x.push(b.relName),y.push(b.relName));var c=!1;$.each(y,function(a,d){if(b.relName===d)return c=!0,!1}),c||(b.hidden===!0&&x.push(b.relName),y.push(b.relName))}),v||$.each(w,function(a,c){b.append('<a id="currentNodeTypes-nodeType-btn-'+c+'" class="currentNodeTypesButton '+u+'" style="background-color: '+color[c]+'">'+c+"</a>");var d=$("#currentNodeTypes-nodeType-btn-"+c);x.indexOf(c)>-1&&(d.css("text-decoration","line-through"),r.eventEmitter[q.id].dispatchEvent("hideNodeType",{nodeType:c,value:!0})),d.on("click",function(){var a=x.indexOf(c);a>-1?($(this).css("text-decoration",""),x.splice(a,1)):(x.push(c),$(this).css("text-decoration","line-through")),r.eventEmitter[q.id].dispatchEvent("hideNodeType",{nodeType:c})}).on("mouseover",function(){j(c)}).on("mouseout",function(){k(c)})})}function h(){return w}function i(){return y}function j(a){var b=[],c=null;q.graph.nodes().forEach(function(d){d.nodeType===a&&(b.push(d),c=n(d.color,-.1))}),q.renderers[0].bind("render",function(a){q.renderers[0].halo({nodeHaloColor:c,nodeHaloSize:10,nodes:b})}),q.refresh({skipIndexation:!0})}function k(a){q.renderers[0].unbind("render"),q.refresh({skipIndexation:!0})}function l(a){q.graph.edges().forEach(function(b){b.relName===a&&(b.active_color="#81ce25",b.active=!0)}),q.refresh({skipIndexation:!0})}function m(a){q.graph.edges().forEach(function(b){b.relName===a&&(b.active_color=q.settings("defaultEdgeActiveColor"),b.active=!1)}),q.refresh({skipIndexation:!0})}function n(a,b){a=String(a).replace(/[^0-9a-f]/gi,""),b=b||0,a.length<6&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]);var c,d,e=o(a.substr(0,2)),f=o(a.substr(2,2)),g=o(a.substr(4,2)),h=p(e,f,g,.5),i="#";for(d=0;d<3;d++)c=h[d],c=Math.round(Math.min(Math.max(0,c+c*b),255)).toString(16),i+=("00"+c).substr(c.length);return i}function o(a){return parseInt(a,16)}function p(a,b,c,d){var e=.3*a+.59*b+.11*c;return a=Math.floor(e*d+a*(1-d)),b=Math.floor(e*d+b*(1-d)),c=Math.floor(e*d+c*(1-d)),[a,b,c]}var q=a,r=b,s="currentNodeTypes",t={},u="",v=!0,w=[],x=[],y=[];c("getCurrentNodeTypes",h),c("getCurrentRelTypes",i),c("highlightNodeType",j),c("unhighlightNodeType",k),c("highlightRelType",l),c("unhighlightRelType",m),this.name=s,this.init=d,this.start=e}}();var Graphbrowser=Graphbrowser||{};Graphbrowser.Modules=Graphbrowser.Modules||{},function(){"use strict";Graphbrowser.Modules.Exporter=function(a,b){function c(a){a&&(j=void 0!==a.onSuccess&&"function"==typeof a.onSuccess?a.onSuccess:void 0,k=void 0!==a.onError&&"function"==typeof a.onError?a.onError:void 0,i.eventEmitter[h.id].bind("saveGraph",e),$(document).on("click","#exporter-saveGraph-form-submit",function(){d(!0)}))}function d(a){var b=$("#exporter-saveGraph-form-name").val();b&&0!==b.length?i.eventEmitter[h.id].dispatchEvent("prepareSaveGraph",{saveAsName:b}):void 0!==k&&k()}function e(a){var b=a.data;b||(b={}),b.mode="all";var c=["fr","fr_x","fr_y"],d=["color"],e=h.toJSON({removeNodeAttributes:c,removeEdgeAttributes:d}),g=JSON.stringify(b);i.conn.saveGraphView(b.name,e,g,currentViewId,f,!1)}function f(){void 0!==j&&j()}var g="exporter",h=a,i=b,j=void 0,k=void 0;this.name=g,this.init=c,this.onSave=e}}();var Graphbrowser=Graphbrowser||{};Graphbrowser.Modules=Graphbrowser.Modules||{};var animating=animating||void 0;!function(){"use strict";Graphbrowser.Modules.fruchtermanReingold=function(a,b){function c(){g.bindBrowserEvent("doLayout",d),$(document).on("click","#fruchtermanReingold-controlElement",function(){d(f,1)})}function d(a,b){a===f&&e(b?b:20)}function e(a){var b={autoArea:!1,area:1e9,gravity:0,speed:.1,iterations:1500,easing:"quadraticInOut",duration:800},c=sigma.layouts.fruchtermanReingold.configure(h,b);c.bind("stop",function(a){window.clearTimeout(j),j=window.setTimeout(function(){j&&(j=0,g.eventEmitter[h.id].dispatchEvent("dataChanged"))},50)}),window.setTimeout(function(){animating=!0,sigma.layouts.fruchtermanReingold.start(h),animating=!1,i++<a?e(a):i=0},40)}var f="fruchtermanReingold",g=b,h=a,i=0,j=0;this.name=f,this.init=c}}();var Graphbrowser=Graphbrowser||{};Graphbrowser.Modules=Graphbrowser.Modules||{},function(){"use strict";Graphbrowser.Modules.Importer=function(a,b){function c(a){a&&(l=void 0!==a.onSuccess&&"function"==typeof a.onSuccess?a.onSuccess:void 0,m=void 0!==a.onError&&"function"==typeof a.onError?a.onError:void 0,$(document).on("click","#importer-controlElement",function(){d()}),$(document).on("click","#importer-loadGraph-submit",function(){k="all",f()}))}function d(){j.conn.getGraphViews(currentViewId,"graphBrowserInfo",e)}function e(a){var b="";a.length<=0&&(b+="<div><span>Keine Ansichten verf√ºgbar</span></div>"),$.each(a,function(a,c){b=b+'<div class="radiobutton importer-loadGraph-radiobuttons"><label><input type="radio"  name="viewButtons" value="'+c.id+'">'+c.name+"</label><div>"}),$("#importer-loadGraph-graphNames").append(b),b=""}function f(){var a=$("#importer-loadGraph-graphNames input[type='radio']:checked").val();void 0!==a&&j.conn.getGraphViewData(a,"graphBrowser",g)}function g(a){var b=JSON.parse(a.graph),c=JSON.parse(a.data);i.graph.clear(),i.graph.read(b),j.eventEmitter[i.id].dispatchEvent("restoreGraph",c),j.eventEmitter[i.id].dispatchEvent("dataChanged"),i.refresh(),l()}var h="importer",i=a,j=b,k=void 0,l=void 0,m=void 0;this.name=h,this.init=c,this.restoreGraph=g}}();var Graphbrowser=Graphbrowser||{};Graphbrowser.Modules=Graphbrowser.Modules||{},function(){"use strict";Graphbrowser.Modules.NewNodesPicker=function(a,b){function c(a){a&&(q=void 0!==a.onFinished&&"function"==typeof a.onFinished?a.onFinished:void 0,r=void 0!==a.onChooseNodes&&"function"==typeof a.onChooseNodes?a.onChooseNodes:void 0,$(document).on("click","#newnodepicker-chooseNodes-markAllSelected",function(){f()}),$(document).on("click","#newnodepicker-chooseNodes-reverseSelection",function(){h()}),$(document).on("click","#newnodepicker-chooseNodes-submit",function(){e()}),l.bindBrowserEvent("pickNodes",d))}function d(a,b,c,d){if(!(a.length<=0)){n=a,m=b,o=c,p=d;var e=[];d&&$("#newnodepicker-chooseNodes-parentNodeTitle").replaceWith('<h3 id="newnodepicker-chooseNodes-parentNodeTitle" class="newnodepicker-chooseNodes-parentNodeTitle">'+d+"</h3>"),$("#newnodepicker-chooseNodes-items").empty(),$.each(n,function(a,b){e.indexOf(b.nodeType)<0&&(e.push(b.nodeType),$("#newnodepicker-chooseNodes-items").append('<div id="newnodepicker-chooseNodes-itemType-'+b.nodeType+'" class="newnodepicker-chooseNodes-itemType newnodepicker-chooseNodes-itemType-'+b.nodeType+'"><h4 id="newnodepicker-chooseNodes-itemType-header-'+b.nodeType+'" class="newnodepicker-chooseNodes-itemType-header newnodepicker-chooseNodes-itemType-header-'+b.nodeType+'">'+b.nodeType+"</h4></div>"),$("#newnodepicker-chooseNodes-itemType-header-"+b.nodeType).on("click",function(){g(b.nodeType)}));var c=!1;return $("input[name='selectedNodeItems[]']").each(function(){$(this).val()===b.id&&(c=!0)}),!!c||void(k.graph.nodes(b.id)?$("#newnodepicker-chooseNodes-itemType-"+b.nodeType).append('<div class="checkbox newnodepicker-chooseNodes-item newnodepicker-chooseNodes-item-'+b.nodeType+'"><label class="newnodepicker-chooseNodes-item-label"><input type="checkbox" disabled name="selectedNodeItems[]" value="'+b.nodeType+"."+b.id+'">'+b.label+"</label></div>"):c||k.graph.nodes(b.id)||$("#newnodepicker-chooseNodes-itemType-"+b.nodeType).append('<div class="checkbox newnodepicker-chooseNodes-item newnodepicker-chooseNodes-item-'+b.nodeType+'"><label><input type="checkbox" name="selectedNodeItems[]" value="'+b.nodeType+"."+b.id+'">'+b.label+"</label></div>"))}),void 0!=r&&r(o,p)}}function e(){$("input[name='selectedNodeItems[]']:not(:checked)").each(function(){var a=$(this).val().split(".");n=n.filter(function(b){return b.id!==a[1]})}),void 0!==q&&q(o,p),void 0!==m&&m(n,o),i()}function f(){$("input[name='selectedNodeItems[]']").each(function(){return $(this).prop("disabled")===!0||void $(this).prop("checked",!0)})}function g(a){$("input[name='selectedNodeItems[]']").each(function(){var b=$(this).val().split(".");return $(this).prop("disabled")===!0||void(b[0]===a&&$(this).prop("checked",!$(this).prop("checked")))})}function h(){$("input[name='selectedNodeItems[]']").each(function(){return $(this).prop("disabled")===!0||void $(this).prop("checked",!$(this).prop("checked"))})}function i(){m=void 0,n=void 0,o=void 0,p=void 0}var j="newNodePicker",k=a,l=b,m=void 0,n=void 0,o=void 0,p=void 0,q=void 0,r=void 0;this.name=j,this.init=c}}();var Graphbrowser=Graphbrowser||{};Graphbrowser.Modules=Graphbrowser.Modules||{},function(){"use strict";Graphbrowser.Modules.NodeExpander=function(a,b){function c(a,b){ca=ca||{},ca[a]=b}function d(a){a&&(C=void 0!==a.container?a.container:"",a.margins=a.margins||{},D=void 0!==a.margins.left?a.margins.left:0,E=void 0!==a.margins.top?a.margins.top:0,a.infoButtons=a.infoButtons||{},P=void 0!==a.infoButtonRenderer?a.infoButtonRenderer:B,N=void 0!==a.defaultInfoButtonColor?a.defaultInfoButtonColor:"#fff",F=void 0!==a.onAddNodes?a.onAddNodes:void 0,G=void 0!==a.onNodesAdded?a.onNodesAdded:void 0,H=void 0!==a.onNodesRemoved?a.onNodesRemoved:void 0,K=void 0!==a.newNodeSize?a.newNodeSize:10,M=void 0!==a.newEdgeSize?a.newEdgeSize:10,L=void 0!==a.edgeType?a.edgeType:"arrow",O=void 0!==a.expandButtonsTimeout?a.expandButtonsTimeout:1e3,e(),"#"!==C.charAt(0)&&(C="#"+C));for(var b in ca)S.api[b]=ca[b]}function e(){S.sigmaCtrl.bindSigmaEvent("clickNode",f),S.sigmaCtrl.bindSigmaEvent("doubleClickNode",g),S.sigmaCtrl.bindSigmaEvent("hovers",h),S.bindBrowserEvent("restoreGraph",x),S.bindBrowserEvent("saveGraph",w),S.bindBrowserEvent("reset",y),S.bindBrowserEvent("undo",u),S.eventEmitter[R.id].bind("dataChanged",v)}function f(a){a.data.node}function g(a){var b=a.data.node,c=b.id;$("#graph-info").empty(),T[c]&&"expanded"===T[c].state?(n(b),S.eventEmitter[R.id].dispatchEvent("dataChanged",{source:Q}),void 0!==H&&"function"==typeof _inNodesRemoved&&_inNodesRemoved()):o(b)}function h(a){a.data.enter.nodes.length>0?i(a.data.enter.nodes[0]):a.data.leave.nodes.length>0&&j(a.data.leave.nodes[0])}function i(a){if(W=!0,I="overNode",U={},_=[],window.clearTimeout(J),J=0,$(C).empty(),!T[a.id]||"expanded"!==T[a.id].state){$(C).append("<span>Loading...</span>");S.conn.getNodes(a,"in",l),S.conn.getNodes(a,"out",k)}}function j(a){J||(J=window.setTimeout(function(){J&&(J=0,$(C).empty(),W=!1)},O))}function k(a,b){Y=!0;a=S.filterNodes(a,"out"),$.each(a,function(a,b){R.graph.nodes(b.targetNode.id)||V[b.targetNode.id]||(V[b.targetNode.id]=!0,U[b.targetNode.type]?U[b.targetNode.type]++:U[b.targetNode.type]=1)}),_.outNodes=a,Y&&X&&Z&&(X=!1,Y=!1,m(b,U))}function l(a,b){X=!0;a=S.filterNodes(a,"in"),$.each(a,function(a,b){R.graph.nodes(b.sourceNode.id)||V[b.sourceNode.id]||(V[b.sourceNode.id]=!0,U[b.sourceNode.type]?U[b.sourceNode.type]++:U[b.sourceNode.type]=1)}),_.inNodes=a,Y&&X&&Z&&(X=!1,Y=!1,m(b,U))}function m(a,b){W=!1;var c=R.renderers[0].conradId,d=$(C),e=Object.keys(b).length,f=0,g=a["renderer"+c+":size"],h=Math.max(g,40),i=Math.floor(a["renderer"+c+":x"]),j=a["renderer"+c+":y"],k=0;switch(e){case 2:k=Math.PI/8*7;break;case 3:k=Math.PI/4*3;break;case 4:k=Math.PI/8*5;break;case 5:k=Math.PI/8*4;break;case 6:k=Math.PI/8*3;break;case 7:k=Math.PI/8*7;break;default:k=Math.PI}e<8&&(e=8),d.empty(),$.each(b,function(b,c){var g=b+" ("+c+")",l=k+2*Math.PI/e*f,m=Math.cos(l),n=Math.sin(l),p=m*h-15,q=n*h-15;d.append('<button class="nodeExpander-expandbutton" id="'+b+'-button" style="position: absolute; top: 0px; left: 0px; z-index: 10000;" title="'+g+'">'+c+"</button>"),d.append(P(b,g));var r=$("#"+b+"-button");r.css("border","none"),r.css("background-color",color[b]),r.css("color","#000"),r.css("top",j+q+E+"px"),r.css("left",i+p+D+"px"),r.on("click",function(c){d.empty(),o(a,b),W=!1}),f++}),V={}}function n(a){if("string"==typeof a&&(a=R.graph.nodes(a)),a){var b=a.id;if(T[b]&&"expanded"===T[b].state){var c=T[b].edges,d=T[b].nodes;$.each(c,function(a,b){try{R.graph.dropEdge(b)}catch(c){}}),$.each(d,function(a,b){n(R.graph.nodes(b));try{R.graph.dropNode(b)}catch(c){}}),T[b].state="collapsed"}}R.refresh()}function o(a,b){if(_.inNodes||_.outNodes){var c=(a.id,a.x),d=a.y,e=[],f=[];$.each(_.outNodes,function(a,g){b&&g.targetNode.type!==b||r(e,f,g,c,d)}),$.each(_.inNodes,function(a,g){b&&g.sourceNode.type!==b||s(e,f,g,c,d)}),q(a,e,f),Z=!0}}function p(a,b){!a||a.length<=0||(T[b]={state:"expanded",id:b,nodes:T[b]?T[b].nodes:[],edges:T[b]?T[b].edges:[]},t(b,a,aa))}function q(a,b,c){_=[],_=$.extend(_,b),aa=$.extend(aa,c),S.eventEmitter[R.id].dispatchEvent("pickNodes",{nodesToSelect:_,onNodesSelected:p,parentNode:a.id,parentTitle:a.label})}function r(a,b,c,d,e){var f=c.sourceNode,g=c.targetNode,h=Math.random()*Math.PI*2,i=R.camera.ratio,j=0,k=0;i>1&&(j=d+Math.cos(h)*(Math.abs(d)/(2*i)),k=e+Math.sin(h)*(Math.abs(e)/(2*i))),i<=1&&(j=d+Math.cos(h)*(Math.abs(d)/(1/i)),k=e+Math.sin(h)*(Math.abs(e)/(1/i)));var l=K;a.push({id:g.id,label:g.name,size:l,x:j,y:k,color:color[g.type],nodeType:g.type}),b.push({id:c.id,source:f.id,target:g.id,size:M,relType:c.type,label:c.relType,type:L,color:R.settings("defaultEdgeColor")})}function s(a,b,c,d,e){var f=c.sourceNode,g=c.targetNode,h=Math.random()*Math.PI*2,i=R.camera.ratio,j=0,k=0;i>1&&(j=d+Math.cos(h)*(Math.abs(d)/(2*i)),k=e+Math.sin(h)*(Math.abs(e)/(2*i))),i<=1&&(j=d+Math.cos(h)*(Math.abs(d)/(1/i)),k=e+Math.sin(h)*(Math.abs(e)/(1/i)));var l=K;a.push({id:f.id,label:f.name,size:l,x:j,y:k,color:color[f.type],nodeType:f.type}),b.push({id:c.id,source:f.id,target:g.id,size:M,relType:c.type,label:c.relType,type:L,color:R.settings("defaultEdgeColor")})}function t(a,b,c){var d=0;void 0!==F&&"function"==typeof F&&F(a),$.each(b,function(b,c){try{S.sigmaCtrl.addNode({id:c.id,label:c.label,size:c.size,x:c.x,y:c.y,color:c.color,nodeType:c.nodeType}),T[a].nodes.push(c.id),d++}catch(e){}}),$.each(c,function(b,c){var e=S.api.findRelationships(c.source,c.target),f=10*e.length;try{S.sigmaCtrl.addEdge({id:c.id,source:c.source,target:c.target,label:c.label,type:c.type,color:c.color,relType:c.relType,relName:c.label,size:c.size,count:f}),T[a].edges.push(c.id),d++}catch(g){}}),_=[],aa=[],sigma.canvas.edges.autoCurve(R),S.eventEmitter[R.id].dispatchEvent("dataChanged",{source:Q}),void 0!==G&&"function"==typeof G&&G()}function u(){ba.length<1||(ba.splice(ba.length-1,1),T=ba[ba.length-1],T||(T={}))}function v(a){var b=a.data.source;if("undo"!==b&&b===Q){var c=jQuery.extend({},T);ba.push(c)}}function w(){var a=JSON.stringify(T);return{name:Q,data:a}}function x(a){var b=a[Q];if(b){var c=JSON.parse(b);T=c}}function y(){ba=[],Object.keys(T).forEach(function(a){delete T[a]})}function z(a){var b=R.graph.nodes(a);Z=!1;S.conn.getNodes(b,"in",l),S.conn.getNodes(b,"out",k);window.setTimeout(function(){o(b)},20)}function A(){$(C).empty()}function B(a,b){return'<button class="btn btn-xs nodeExpander-infobutton" style="margin: 4px; color: #000; background-color: '+(color[a]||N)+'">'+b+"</button>"}var C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q="nodeExpander",R=a,S=b,T={},U={},V={},W=!1,X=!1,Y=!1,Z=!0,_=[],aa=[],ba=[],ca={};c("collapseNode",n),c("expandNode",z),c("hideExpandButtons",A),this.name=Q,this.init=d}}();var Graphbrowser=Graphbrowser||{};Graphbrowser.Modules=Graphbrowser.Modules||{},function(){"use strict";Graphbrowser.Modules.NodeFilter=function(a,b){function c(a,b){C=C||{},C[a]=b}function d(a){a?(t=void 0!==a.filterType&&("whitelist"===a.filterType||"blacklist"===a.filterType)?a.filterType:"blacklist",s=void 0===a.filterOnStart||a.filterOnStart,u=void 0!==a.filterNodeTypes?a.filterNodeTypes:[]):(t="blacklist",s=!1,u=[]),x.eventEmitter[w.id].bind("hideNodeType",l),x.eventEmitter[w.id].bind("hideNodes",m),x.bindBrowserEvent("filterNodes",e),x.bindBrowserEvent("start",r);for(var b in C)x.api[b]=C[b];x.api.addNodeTypeToFilter=h,x.api.removeNodeTypeFromFilter=j,x.api.setFilterType=i,x.api.addNodeTypeToFilter=h,x.api.removeNodeTypeFromFilter=j,x.api.clearFilterNodeTypes=k,x.api.filterGraph=p,x.api.hideNodes=m,x.api.hideNode=q,x.api.hideNodeType=l,x.api.hideRelType=n,x.api.hideRels=o}function e(a,b){return"in"===b?f(a):"out"===b?g(a):void 0}function f(a){return a&&$.each(u,function(b,c){a=a.filter(function(a){if("blacklist"===t)return a.sourceNode.type!==c;if(a.sourceNode.type!==c){var b=!1;return $.each(u,function(c,d){a.sourceNode.type===d&&(b=!0)}),b}return!0})}),a}function g(a){return a&&$.each(u,function(b,c){a=a.filter(function(a){if("blacklist"===t)return a.targetNode.type!==c;if(a.targetNode.type!==c){var b=!1;return $.each(u,function(c,d){a.targetNode.type===d&&(b=!0)}),b}return!0})}),a}function h(a){void 0!==a&&u.push(a)}function i(a){void 0!==a&&("whitelist"!==a&&"blacklist"!==a||(t=a))}function j(a){void 0!==a&&u.splice(u.indexOf(a),1)}function k(){u=[]}function l(a,b){var c,d;a.data?(c=a.data.nodeType,d=a.data.value):(c=a,d=b),d?y[c]=d:y[c]?y[c]=!y[c]:y[c]=!0,$.each(w.graph.nodes(),function(a,b){if(b.nodeType===c){if(void 0!==z[b.id]&&z[b.id].hidden===!0)return!0;b.hidden=y[c]}}),w.refresh({skipIndexation:!0})}function m(a){var b=a.data.nodes,c=a.data.status;$.each(b,function(a,b){$.each(w.graph.nodes(),function(a,d){if(b.id===d.id)return y[b.nodeType]===!0||(z[b.id]={},z[b.id].hidden=c,d.hidden=c,!1)})}),w.refresh({skipIndexation:!0})}function n(a,b){b?A[a]=b:A[a]?A[a]=!A[a]:A[a]=!0,$.each(w.graph.edges(),function(b,c){if(c.relName===a){if(void 0!==B[c.id]&&B[c.id].hidden===!0)return!0;c.hidden=A[a]}}),w.refresh({skipIndexation:!0})}function o(a,b){$.each(a,function(a,c){$.each(w.graph.edges(),function(a,d){if(c.id===d.id)return A[c.relName]===!0||(B[c.id]={},B[c.id].hidden=b,d.hidden=b,!1)})}),w.refresh({skipIndexation:!0})}function p(){var a=[];$.each(u,function(b,c){$.each(w.graph.nodes(),function(b,d){if(d.nodeType===c&&"blacklist"===t&&a.push(d.id),d.nodeType!==c&&"whitelist"===t){var e=!0;$.each(u,function(a,b){d.nodeType===b&&(e=!1)}),e&&a.push(d.id)}})}),$.each(a,function(a,b){w.graph.dropNode(b)}),x.refreshSigma(!1,!0)}function q(a,b){var c=w.graph.nodes(a);c&&(c.hidden=b,w.refresh({skipIndexation:!0}))}function r(){s&&u.length>0&&p()}var s,t,u,v="nodeFilter",w=a,x=b,y={},z={},A={},B={},C={};c("addNodeTypeToFilter",h),c("setFilterType",i),c("removeNodeTypeFromFilter",j),c("clearFilterNodeTypes",k),c("hideNodeType",l),c("hideNodes",m),c("hideRelType",n),c("hideRels",o),c("filterGraph",p),c("hideNode",q),this.name=v,this.init=d}}();var Graphbrowser=Graphbrowser||{};Graphbrowser.Modules=Graphbrowser.Modules||{},function(){"use strict";Graphbrowser.Modules.RelationshipEditor=function(a,b){function c(a){if(a){if(y=void 0!==a.incommingRelationsKey?a.incommingRelationsKey:"shiftKey",z=void 0!==a.outgoingRelationsKey?a.outgoingRelationsKey:"ctrlKey",B=void 0!==a.deleteEvent?a.deleteEvent:"rightClickEdges",C=void 0!==a.onDeleteRelation?a.onDeleteRelation:void 0,D=void 0!==a.maxDistance?a.maxDistance:200,void 0===typeof this.getRelationshipEditorWorker)throw new Error("Graph-Browser-RelationshipEditor: Worker not found.");var b=this.getRelationshipEditorWorker();if(window.Worker&&!w){var c=new Blob([b],{type:"application/javascript"});w=new Worker(URL.createObjectURL(c)),w.onmessage=i,v.conn.getSchemaInformation(p)}else console.log("Graph-Browser-RelationshipEditor: It seems that your browser does not support webworkers.");A={shiftKey:!1,ctrlKey:!1,altKey:!1,noKey:!0},E=!1,t=!0,d()}else t=!1}function d(){v.sigmaCtrl.bindSigmaEvent("keyup",g),v.sigmaCtrl.bindSigmaEvent("keydown",g),v.sigmaCtrl.bindSigmaEvent(B,h),v.bindBrowserEvent("start",f),v.eventEmitter[u.id].bind("dataChanged",q),v.eventEmitter[u.id].bind("kill",e)}function e(){v.sigmaCtrl.unbindSigmaEvent("keyup",g),v.sigmaCtrl.unbindSigmaEvent("keydown",g),v.sigmaCtrl.unbindSigmaEvent(B,h),v.eventEmitter[u.id].unbind("kill",f),v.eventEmitter[u.id].unbind("dataChanged",q),w.terminate(),w=void 0}function f(){t&&v.conn.getSchemaInformation(p)}function g(a){var b=a.ctrlKey||a.shiftKey;A={ctrlKey:a.ctrlKey,shiftKey:a.shiftKey,noKey:!b},A.noKey||E?(E=!1,v.sigmaCtrl.unbindSigmaEvent("startdrag",h),v.sigmaCtrl.unbindSigmaEvent("drag",h),v.sigmaCtrl.unbindSigmaEvent("dragend",h),window.setTimeout(function(){w.postMessage({msg:"removeNewEdges",edges:u.graph.edges(),nodes:u.graph.nodes()})},50)):(E=!0,v.sigmaCtrl.bindSigmaEvent("startdrag",h),v.sigmaCtrl.bindSigmaEvent("drag",h),v.sigmaCtrl.bindSigmaEvent("dragend",h))}function h(a){if(t)switch(a.type){case"startdrag":w&&w.postMessage({msg:"updateGraphInfo",nodes:u.graph.nodes(),edges:u.graph.edges()
});case"drag":w&&w.postMessage({msg:"handleDrag",dragedNode:a.data.node,keys:A,cameraRatio:u.camera.ratio});break;case"dragend":o(a.data.node);break;case B:n(a.data.edge)}}function i(a){var b=a.data.msg;switch(b){case"add":j(a.data.edge,a.data.remove);break;case"removeNewEdge":k(a.data.edge);break;case"hideEdge":l(a.data.edge);break;case"unhideEdge":m(a.data.edge);break;case"debug":console.log(a.data.text)}}function j(a,b){if(void 0!==b)var c=u.graph.edges(b);c&&(c.lock||u.graph.dropEdge(b)),u.graph.edges(a.id)||u.graph.addEdge(a),sigma.canvas.edges.autoCurve(u),u.refresh({skipIndexation:!1}),q()}function k(a){var b=u.graph.edges(a);b&&(b.lock||u.graph.dropEdge(a)),sigma.canvas.edges.autoCurve(u),u.refresh({skipIndexation:!1}),q()}function l(a){var b=u.graph.edges(a);b.hidden||(b.hidden=!0,sigma.canvas.edges.autoCurve(u),u.refresh({skipIndexation:!0}))}function m(a){var b=u.graph.edges(a)||{};b.hidden&&(b.hidden=!1,sigma.canvas.edges.autoCurve(u),u.refresh({skipIndexation:!0}))}function n(a,b){var c=u.renderers[0].container;if($("body").on("contextmenu",c,function(a){return!1}),void 0!==C&&void 0===b){var d=u.graph.nodes(a.source),e=u.graph.nodes(a.target);C(a,d,e,n)}b&&v.conn.deleteRelationship(a.id,function(b){console.log("DeleteEdgeEvent: "+a.id),u.graph.dropEdge(a.id),sigma.canvas.edges.autoCurve(u),u.refresh({skipIndexation:!1}),q()})}function o(a){$.each(u.graph.edges(),function(a,b){b.added&&(b.lock=!0,w.postMessage({msg:"commitNewEdge",edge:b.id}),v.conn.createRelationship(b.source,b.target,b.relType,function(a){var c=b;u.graph.dropEdge(b.id),c.id=a[0],c.color=u.settings("defaultEdgeColor"),c.size=u.settings("newEdgeSize"),c.type=u.settings("newEdgeType"),c.added=!1,c.replaced=void 0,c.lock=!1,c.cc=void 0,u.graph.addEdge(c),u.refresh({skipIndexation:!1}),sigma.canvas.edges.autoCurve(u),q()},b.id,r))})}function p(a){x={},$.each(a,function(a,b){x[b.type]=b}),w.postMessage({msg:"init",settings:{schema:x,maxDistance:D,nodes:u.graph.nodes(),edges:u.graph.edges(),rendererId:u.renderers[0].conradId}})}function q(a){w&&w.postMessage({msg:"updateGraphInfo",nodes:u.graph.nodes(),edges:u.graph.edges()})}function r(a,b){if("Relationship already exists"===b){var c=u.graph.edges(a);v.conn.getRelationshipsOfType(c.relType,function(b){$.each(b,function(b,d){return d.sourceId===c.source&&d.targetId===c.target?(void 0===u.graph.edges(d.id)&&(u.graph.addEdge({id:d.id,source:d.sourceId,target:d.targetId,relType:d.relType,label:d.relType,size:u.settings("newEdgeSize"),type:u.settings("newEdgeType"),color:u.settings("defaultEdgeColor"),cc:void 0}),sigma.canvas.edges.autoCurve(u)),!1):void(u.graph.edges(a)&&u.graph.dropEdge(a))})})}else u.graph.dropEdge(a);v.eventEmitter[u.id].dispatchEvent("dataChanged")}var s="relationshipEditor",t=!0,u=a,v=b,w=void 0,x=void 0,y=void 0,z=void 0,A={},B=void 0,C=void 0,D=0,E=!1;this.name=s,this.init=c}}(),function(){"use strict";function a(){return";("+b.toString()+").call(this);"}var b=function(a){function b(a){l=void 0!==a.schema?a.schema:[],m=void 0!==a.maxDistance?a.maxDistance:200,n=void 0!==a.nodes?a.nodes:[],o=void 0!==a.edges?a.edges:[],void 0!==a.rendererId?r=a.rendererId:rendererId=0,q=void 0,p=void 0}function c(a,b,c){p=a,q=b}function d(a,b,c){if(n=p||n,o=q||o,l){for(var d=l[a.nodeType],f=0;f<n.length;f++)if(a.id!==n[f].id){var h=g(n[f],a),j="not",k=void 0,r=void 0,u=void 0,v=void 0,w=void 0,x=h;if(void 0===d)return;switch(c>1&&(x=h*c),c<1&&(x=h*c),b.shiftKey===!0&&x<=m?j="to":b.ctrlKey===!0&&x<=m&&(j="from"),j){case"from":if(void 0!==d.relatedFrom){for(var y,z=m/d.relatedFrom.length,A=d.relatedFrom.length;A>=0;)h<A*z&&(y=A),A--;if(y){y-=1,u=d.relatedFrom[y];var B=y+":"+n[f].id+":"+a.id;k="allSourceTypesPossible",r="possibleSourceTypes",w=a.id,v=n[f].id}}break;case"to":if(void 0!==d.relatedTo){for(var y,z=m/d.relatedTo.length,A=d.relatedTo.length;A>=0;)h<A*z&&(y=A),A--;if(y){y-=1,u=d.relatedTo[y];var B=y+":"+a.id+":"+n[f].id;k="allTargetTypesPossible",r="possibleTargetTypes",w=n[f].id,v=a.id}}break;default:for(var C=0;C<o.length;C++)if((o[C].source===a.id&&o[C].target===n[f].id||o[C].source===n[f].id&&o[C].target===a.id)&&o[C].added){if(t[o[C].id]){for(var D=0;D<t[o[C].id].length;D++)i(t[o[C].id][D]);t[o[C].id]=void 0}s[n[f].id]=s[n[f].id]||{},s[n[f].id].id=s[n[f].id].id||"",o[C].dropped||(postMessage({msg:"removeNewEdge",edge:o[C].id}),o[C].dropped=!0,s[n[f].id].id===o[C].id&&(s[n[f].id].id=void 0))}}if(void 0!==u&&(u[k]===!0||u[r].split(",").indexOf(n[f].nodeType)>-1)){var E=!0,F=!1;if("1"===u.sourceMultiplicity)for(var G=0;G<o.length&&(o[G].target!==w||o[G].relType!==u.type||(o[G].source===v?(E=!1,F=!0):E=e(o[G],B),E));G++);if("1"===u.targetMultiplicity)for(var H=0;H<o.length&&(o[H].source!==v||o[H].relType!==u.type||(o[H].target===w?(E=!1,F=!0):E=e(o[H],B),E));H++);if(s[n[f].id]=s[n[f].id]||{},s[n[f].id].id=s[n[f].id].id||"",s[n[f].id].id!==B&&E){var I,J;switch(j){case"to":I=a.id,J=n[f].id;break;case"from":I=n[f].id,J=a.id}var K={id:B,label:u.relationshipType,source:I,target:J,size:40,color:"#81ce25",type:"curvedArrow",added:!0,relType:u.type};if(t[s[n[f].id].id]){for(var L=t[s[n[f].id].id],M=0;M<L.length;M++)i(L[M]);delete t[s[n[f].id].id]}postMessage({msg:"add",edge:K,remove:s[n[f].id].id}),s[n[f].id].id=B}}}void 0!==p&&void 0!==q&&(o=q,n=p,p=void 0,q=void 0)}}function e(a,b){var c=!0;return a.added?c=!1:a.hidden||(t[b]?(t[b].push(a),c=!1,h(a)):(t[b]=[],t[b].push(a),c=!0,h(a))),c}function f(a,b){for(var c=0;c<b.length;c++)if(b[c].added){if(t[b[c].id])for(var d=0;d<t[b[c].id].length;d++)i(t[b[c].id][d]);postMessage({msg:"removeNewEdge",edge:b[c].id})}t={},s={}}function g(a,b){var c=parseFloat(a["renderer"+r+":x"]),d=parseFloat(a["renderer"+r+":y"]),e=parseFloat(b["renderer"+r+":x"]),f=parseFloat(b["renderer"+r+":y"]),g=Math.sqrt(Math.pow(e-c,2)+Math.pow(f-d,2));return g}function h(a){a.hidden=!0,postMessage({msg:"hideEdge",edge:a.id})}function i(a){a.hidden=!1,postMessage({msg:"unhideEdge",edge:a.id})}function j(a){a.removed||(a.removed=!0,postMessage({msg:"removeNewEdge",edge:a.id}))}function k(a){if(t[a])for(var b=0;b<t[a].length;b++)j(t[a][b])}var l,m,n,o,p,q,r,s={},t={},u=function(a){var e=a.data.msg;switch(e){case"init":b(a.data.settings);break;case"updateGraphInfo":c(a.data.nodes,a.data.edges);break;case"handleDrag":d(a.data.dragedNode,a.data.keys,a.data.cameraRatio);break;case"removeNewEdges":f(a.data.nodes,a.data.edges);break;case"commitNewEdge":k(a.data.edge)}};this.addEventListener("message",u)};if("undefined"==typeof Graphbrowser.Modules.RelationshipEditor)throw"Graphbrowser.Modules.RelationshipEditor is not declared";Graphbrowser.Modules.RelationshipEditor.prototype.getRelationshipEditorWorker=a}();var Graphbrowser=Graphbrowser||{};Graphbrowser.Modules=Graphbrowser.Modules||{},function(){"use strict";Graphbrowser.Modules.SelectionTools=function(a,b){function c(a,b){x=x||{},x[a]=b}function d(a){for(var b in x)t.api[b]=x[b];t.bindBrowserEvent("restoreGraph",p)}function e(){u||(u=!0,s.renderers[0].bind("render",function(a){s.renderers[0].halo({nodes:t.sigmaPlugins.activeState.nodes()})}),t.sigmaPlugins.lasso.bind("selectedNodes",function(a){window.clearTimeout(v),v=setTimeout(function(){w[q].hidden&&g(q,!1),w[q].fixed&&h(q,!1),a.data.length<=0||(w[q].nodes=a.data,m(!1),s.refresh({skipIndexation:!0}),l(),v=0)},10)}),l(),s.refresh({skipIndexation:!0}))}function f(){var a=parseInt(4999*Math.random()).toString();return w[a]={id:a,nodes:[],hidden:!1,fixed:!1},q=a,a}function g(a,b){void 0!==b&&w[a].hidden!==b&&(w[a].hidden=b,t.eventEmitter[s.id].dispatchEvent("hideNodes",{nodes:w[a].nodes,status:b}))}function h(a,b){void 0!==b&&w[a].fixed!==b&&(w[a].fixed=b,$.each(w[a].nodes,function(b,c){$.each(s.graph.nodes(),function(b,d){c.id===d.id&&(d.fixed=w[a].fixed,c.fixed=w[a].fixed)})}))}function i(a){onHideSelectionGroup(a,!1),setSelectionFixed(a,!1),t.sigmaPlugins.activeState.dropNodes(),w[a].nodes=void 0,s.refresh({skipIndexation:!0})}function j(a){i(),w.splice(w.indexof(a),1)}function k(a){u!==!1&&void 0!==a&&(q=a,l())}function l(){if(u||void 0!==w[q].nodes){t.sigmaPlugins.activeState.dropNodes();var a=[];$.each(w[q].nodes,function(b,c){a.push(c.id)}),t.sigmaPlugins.activeState.addNodes(a),s.refresh({skipIndexation:!0})}}function m(a){t.sigmaPlugins.lasso.isActive||a!==!0?t.sigmaPlugins.lasso.deactivate():(u||e(),t.sigmaPlugins.lasso.activate())}function n(a){u&&(u=!1,t.sigmaPlugins.lasso.isActive&&m(!1),s.renderers[0].unbind("render"),t.sigmaPlugins.activeState.dropNodes(),t.refreshSigma(!0))}function n(a){u=!1,t.sigmaPlugins.lasso.isActive&&m(!1),s.renderers[0].unbind("render"),t.sigmaPlugins.activeState.dropNodes(),t.refreshSigma(!0)}function o(a){var b=w[a].nodes;void 0!==b&&b.length>0&&(t.sigmaPlugins.activeState.dropNodes(),$.each(b,function(a,b){s.graph.nodes(b.id)&&s.graph.dropNode(b.id)}),s.refresh(),$.each(w,function(a,b){var c=[];$.each(b.nodes,function(a,b){s.graph.nodes(b.id)||c.push(b.id)}),$.each(c,function(a,c){b.nodes.splice(b.nodes.indexOf(c),1)})}))}function p(){w=[],f(),u&&(t.sigmaPlugins.activeState.dropNodes(),l())}var q,r="selectionTools",s=a,t=b,u=!1,v=0,w={},x={};c("activateSelectionTools",e),c("createSelectionGroup",f),c("hideSelectionGroup",g),c("fixateSelectionGroup",h),c("clearSelectionGroup",i),c("deleteSelectionGroup",j),c("activateSelectionGroup",k),c("updateActiveState",l),c("activateSelectionLasso",m),c("deactivateSelectionTools",n),c("deactivateSelectionTools",n),c("dropSelection",o),this.name=r,this.init=d}}();var Graphbrowser=Graphbrowser||{};Graphbrowser.Modules=Graphbrowser.Modules||{},function(){"use strict";Graphbrowser.Modules.StatusUndo=function(a,b){function c(a){a&&a.active&&(l=0,$(document).on("click","#statusUndo-controlElement",function(){f()})),k.eventEmitter[j.id].bind("dataChanged",e),k.bindBrowserEvent("start",d),k.bindBrowserEvent("status",g),k.bindBrowserEvent("reset",h),k.api.undo=f}function d(){e(),l--}function e(a){var b;if(b=a?a.data.source:"","undo"!==b){var c=JSON.parse(JSON.stringify(j.graph.nodes())),d=JSON.parse(JSON.stringify(j.graph.edges())),e=JSON.parse(JSON.stringify(j.camera));m.push({graph:{nodes:c,edges:d},camera:e}),l++}}function f(){var a=[];if(m.length<=1)return void(l=0);l--,k.undo(),m.splice(m.length-1,1);var b=j.graph.edges();$.each(b,function(a,b){j.graph.dropEdge(b.id)}),$.each(j.graph.nodes(),function(b,c){var d=!1;$.each(m[m.length-1].graph.nodes,function(b,e){c.id===e.id&&(d=!0,c.to_x=e.x,c.to_y=e.y,a.push(c.id))}),d||j.graph.dropNode(c.id)}),$.each(m[m.length-1].graph.nodes,function(a,b){var c=!0;$.each(j.graph.nodes(),function(a,d){d.id===b.id&&(c=!1)}),c&&(k.sigmaCtrl.addNode(b),j.graph.nodes(b.id).x=b.x,j.graph.nodes(b.id).y=b.y)}),$.each(m[m.length-1].graph.edges,function(a,b){k.sigmaCtrl.addEdge(b)}),sigma.plugins.animate(j,{x:"to_x",y:"to_y"},{nodes:a,onComplete:function(){k.refreshSigma(!1,!1)},easing:"quadraticInOut",duration:800}),k.eventEmitter[j.id].dispatchEvent("dataChanged",{source:"undo"})}function g(){return l}function h(){l=1,m.length>=2&&m.splice(2,m.length-2),f()}var i="statusUndo",j=a,k=b,l=void 0,m=[];this.name=i,this.init=c,this.status=g}}();var Graphbrowser=Graphbrowser||{};Graphbrowser.Modules=Graphbrowser.Modules||{},function(){"use strict";Graphbrowser.Modules.Swimlane=function(a,b){function c(a){if(void 0!==a){if(void 0!==a.critX&&"string"==typeof a.critX){var b=a.critX.split(".");k=b[0],m=b[1],u=b[2]}if(void 0!==a.critY&&"string"==typeof a.critY){var b=a.critY.split(".");l=b[0],n=b[1],v=b[2]}o=void 0!==a.view?a.view:"_graph",r=void 0!==a.nodesShape?a.nodesShape:"",s=void 0!==a.standartNodeShape?a.standardNodeShape:"",y.sigmaCtrl.bindSigmaEvent("startdrag",g)}y.bindBrowserEvent("reset",f),y.bindBrowserEvent("undo",i),y.bindBrowserEvent("doLayout",d),y.eventEmitter[x.id].bind("dataChanged",h)}function d(a,b,c){var d=void 0;if(a===w){if(void 0!==b&&"object"==typeof b){p=b;var f=b.critX.split(".");k=f[0],m=f[1],u=f[2],f=b.critY.split("."),l=f[0],n=f[1],v=f[2],void 0!==b.view&&(o=b.view),void 0!==b.nodesShape&&(r=b.nodesShape||"")}c?($.each(x.graph.nodes(),function(a,b){$.each(A,function(a,c){if(b.id===c.id){var d=u||k,e=v||l;switch(m){case"string":void 0!==c[d]?b[k]=c[d]:b[k]="";break;case"date":void 0!==c[d]?b[k]=Date.parse(c[d]):b[k]=144e5;break;default:void 0!==c[d]?b[k]=c[d]:b[k]=0}switch(n){case"string":void 0!==c[e]?b[l]=c[e]:b[l]="";break;case"date":void 0!==c[e]?b[l]=Date.parse(c[e]):b[l]=144e5;break;default:void 0!==c[e]?b[l]=c[e]:b[l]=0}return!1}})}),d=sigma.layouts.swimlane.start(x,{critX:k,critY:l}),d.bind("stop",function(a){window.clearTimeout(z),z=window.setTimeout(function(){y.eventEmitter[x.id].dispatchEvent("dataChanged",{source:w}),r&&$.each(x.graph.nodes(),function(a,b){C[b.id]=b.type,b.type=r,b.sw=!0,y.refreshSigma(!0,!1)})},50)}),A=[],q=0):$.each(x.graph.nodes(),function(a,b){y.conn.getData(b,"node",e,o)})}}function e(a,b){if(void 0!==a)A.push(a);else{var c={id:b.id};c[k]=k+" empty",c[l]=l+" empty",A.push(c)}window.clearTimeout(q),q=window.setTimeout(function(){d(w,void 0,!0)},100)}function f(){t=s||"",j(!0)}function g(a){t=s||"",j(!1)}function h(a){var b=a.data.source;if("undo"!==b){var c;c=void 0===l?"":new String(l),b!==w?(B.push({self:!1,critY:c.toString()}),j()):B.push({self:!0,critY:c.toString()})}}function i(){if(B.length<=1)t=s,j(!0);else{B.splice(B.length-1,1);var a=B[B.length-1].critY||"";B[B.length-1].self===!0?(t=r,sigma.layouts.swimlane.showGrid(x,{critY:a}),$.each(x.graph.nodes(),function(a,b){C[b.id]=b.type,b.sw=!0,b.type=t})):(t=s,j(!1))}}function j(a){sigma.layouts.swimlane&&(sigma.layouts.swimlane.kill(x),$.each(x.graph.nodes(),function(a,b){C[b.id]?(b.type=C[b.id],delete C[b.id]):b.sw&&(b.type=x.settings("defaultNodeShape")),delete b.sw}),y.refreshSigma(!1,!1),a&&(B=[]))}var k,l,m,n,o,p,q,r,s,t,u,v,w="swimlane",x=a,y=b,z=0,A=[],B=[],C={};this.name=w,this.init=c}}();var Graphbrowser=Graphbrowser||{};Graphbrowser.Modules=Graphbrowser.Modules||{},function(){"use strict";Graphbrowser.Modules.Toolstips=function(a,b){function c(a){if(void 0!==a){a.node&&(v=!0,i=void 0!==a.node.showOn?a.node.showOn:"rightClickNode",j=void 0!==a.node.hideOn?a.node.hideOn:"clickStage",l=void 0!==a.node.position?a.node.position:"bottom",k=void 0!==a.node.cssClass?a.node.cssClass:"node-tooltip-container",m=void 0!==a.node.renderer&&"function"==typeof a.node.renderer?a.node.renderer:void 0),a.edge&&(w=!0,n=void 0!==a.edge.showOn?a.edge.showOn:"rightClickEdge",o=void 0!==a.edge.hideOn?a.edge.hideOn:"clickStage",q=void 0!==a.edge.position?a.edge.position:"bottom",p=void 0!==a.edge.cssClass?a.edge.cssClass:"edge-tooltip-container",r=void 0!==a.edge.renderer&&"function"==typeof a.edge.renderer?a.edge.renderer:void 0),f=void 0!==a.page?a.page:void 0,g=void 0!==a.onShow&&"function"==typeof a.onShow?a.onShow:void 0,h=void 0!==a.onError&&"function"==typeof a.onError?a.onError:void 0;var b={};v&&(b.node={show:i,hide:j,position:l,template:'<div id="node-tooltip-container" class="'+k+'"></div>',renderer:function(a,b){return m?m(a):(self.loadStructrPageContent(a),"")}}),w&&(b.edge={show:n,hide:o,position:q,template:'<div id="edge-tooltip-container" class="'+p+'"></div>',renderer:function(a,b){return r?r(a):(self.loadStructrPageContent(a),"")}}),e=sigma.plugins.tooltips(t,t.renderers[0],b)}u.api.closeTooltip=d}function d(){e.close()}var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s="tooltips",t=a,u=b,v=!1,w=!1;this.name=s,this.init=c}}();