/* graph-browser.js*/
var Graphbrowser=Graphbrowser||{};Graphbrowser.Control=Graphbrowser.Control||{};var animating=animating||void 0;(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k=!1,l=!1,m=!1,n=[],o=[];Graphbrowser.Control.SigmaControl=function(a,f){var g=this;g.name="SigmaControl",b=a,c=void 0!==f.sigmaSettings?f.sigmaSettings:{immutable:!1,minNodeSize:1,maxNodeSize:10,borderSize:4,defaultNodeBorderColor:"#a5a5a5",singleHover:!0,doubleClickEnabled:!1,minEdgeSize:4,maxEdgeSize:4,enableEdgeHovering:!0,edgeHoverColor:"default",edgeHoverSizeRatio:1.3,edgeHoverExtremities:!0,defaultEdgeColor:"#999",defaultEdgeHoverColor:"#888",minArrowSize:4,maxArrowSize:8,labelSize:"proportional",labelSizeRatio:1,labelAlignment:"right",nodeHaloColor:"rgba(236, 81, 72, 0.2)",nodeHaloSize:20},d=void 0!==f.graphContainer&&"string"==typeof f.graphContainer?f.graphContainer:"graph-container",e=void 0!==f.lassoSettings?f.lassoSettings:{strokeStyle:"rgb(236, 81, 72)",lineWidth:2,fillWhileDrawing:!0,fillStyle:"rgba(236, 81, 72, 0.2)",cursor:"crosshair"}},Graphbrowser.Control.SigmaControl.prototype.init=function(){var p=this;return sigma.renderers.def=sigma.renderers.canvas,a=new sigma({container:d,settings:c}),g=sigma.plugins.activeState(a),i=sigma.plugins.keyboard(a,a.renderers[0]),j=sigma.plugins.select(a,g),j.bindKeyboard(i),f=new sigma.plugins.dragNodes(a,a.renderers[0],g),h=new sigma.plugins.lasso(a,a.renderers[0],e),j.bindLasso(h),i.bind("32+83",function(){p.toggleLasso()}),p.activate(),$(window).keyup(function(a){switch(a.which){case 16:k=!1;break;case 17:l=!1;break;case 18:m=!1;break;default:return!1}for(var b=k||m||l,c=0;c<n.length;c++)n[c]({shiftKey:k,ctrlKey:l,altKey:m,noKey:!b})}),$(window).on("keydown",function(a){switch(27===a.keyCode&&a.preventDefault(),a.which){case 16:k=!0;break;case 17:l=!0;break;case 18:m=!0}for(var b=k||m||l,c=0;c<o.length;c++)o[c]({shiftKey:k,ctrlKey:l,altKey:m,noKey:!b})}),b.sigmaCtrl={},b.sigmaPlugins={},b.sigmaCtrl.unbindSigmaEvent=p.unbindEvent,b.sigmaCtrl.bindSigmaEvent=p.bindEvent,b.sigmaPlugins.activeState=g,b.sigmaPlugins.keyboard=i,b.sigmaPlugins.select=j,b.sigmaPlugins.lasso=h,b.api.bindEvent=p.bindEvent.bind(p),b.api.unbindEvent=p.unbindEvent.bind(p),b.api.addNode=p.addNode.bind(p),b.api.addEdge=p.addEdge.bind(p),b.api.dropNode=p.dropNode.bind(p),b.api.dropNodes=p.dropNodes.bind(p),b.api.dropEdge=p.dropEdge.bind(p),b.api.dropEdges=p.dropEdges.bind(p),b.api.dropElement=p.dropElement.bind(p),b.api.updateNode=p.updateNode.bind(p),b.api.updateEdge=p.updateEdge.bind(p),b.api.getCameraRatio=p.getCameraRatio.bind(p),b.api.getNode=p.getNode.bind(p),b.api.getEdge=p.getEdge.bind(p),b.api.getNodes=p.getNodes.bind(p),b.api.getEdges=p.getEdges.bind(p),b.api.findRelationships=p.findRelationships.bind(p),b.api.changeSigmaSetting=p.changeSigmaSetting.bind(p),a},Graphbrowser.Control.SigmaControl.prototype.activate=function(){var a=this;a.isActive=!0},Graphbrowser.Control.SigmaControl.prototype.deactivate=function(){b.refreshSigma()},Graphbrowser.Control.SigmaControl.prototype.unbindEvent=function(b,c){if("string"==typeof b&&"function"==typeof c){if("keyup"===b){var d=n.indexOf(c);n.splice(d,1)}if("keydown"===b){var d=o.indexOf(c);o.splice(d,1)}b.includes("drag")?f.unbind(b,c):a.unbind(b,c)}},Graphbrowser.Control.SigmaControl.prototype.bindEvent=function(b,c){"string"==typeof b&&"function"==typeof c&&("keyup"===b&&n.push(c),"keydown"===b&&o.push(c),b.includes("drag")?f.bind(b,c):a.bind(b,c))},Graphbrowser.Control.SigmaControl.prototype.addNode=function(b){"string"==typeof b?a.graph.addNode({id:b,label:"",color:a.settings("defaultNodeColor"),size:a.settings("defaultNodeSize")}):a.graph.addNode(b),a.refresh()},Graphbrowser.Control.SigmaControl.prototype.addEdge=function(b,c,d){void 0!==c&&void 0!==d&&"string"==typeof b?a.graph.addEdge({id:b,source:c,target:d,color:a.settings("defaultEdgeColor"),size:a.settings("defaultEdgeSize")}):"object"==typeof b&&a.graph.addEdge(b),a.refresh()},Graphbrowser.Control.SigmaControl.prototype.dropNode=function(b){"string"==typeof b?a.graph.nodes(b)&&a.graph.dropNode(b):a.graph.nodes(b.id)&&a.graph.dropNode(b.id),a.refresh()},Graphbrowser.Control.SigmaControl.prototype.dropNodes=function(b,c){c?$.each(a.graph.nodes(),function(c,d){b.indexOf(d.id)<0&&a.graph.dropNode(d)}):$.each(a.graph.nodes(),function(c,d){b.indexOf(d.id)>=0&&a.graph.dropNode(d)}),a.refresh()},Graphbrowser.Control.SigmaControl.prototype.dropEdge=function(b){"string"==typeof b?a.graph.edges(b)&&a.graph.dropEdge(b):a.graph.edges(b.id)&&a.graph.dropEdge(b.id),a.refresh()},Graphbrowser.Control.SigmaControl.prototype.dropEdges=function(b,c){c?$.each(a.graph.edges(),function(c,d){b.indexOf(d.id)<0&&a.graph.dropEdge(d)}):$.each(a.graph.edges(),function(c,d){b.indexOf(d.id)>=0&&a.graph.dropEdge(d)}),a.refresh()},Graphbrowser.Control.SigmaControl.prototype.dropElement=function(b){a.graph.nodes(b)?a.graph.dropNode(b):a.graph.edges(b)&&a.graph.dropEdge(b),a.refresh()},Graphbrowser.Control.SigmaControl.prototype.updateNode=function(b,c,d,e){var f=a.graph.nodes(b);if(void 0!==f){if(c.id&&(f.id=c.id),c.label&&(f.label=c.label),c.color&&(f.color=c.color),c.size&&(f.size=c.size),c.nodeType&&(f.nodeType=c.nodeType),c.x&&(f.x=c.x),c.y&&(f.y=c.y),$.isArray(d))for(var g=0;g<d.length;g++)f[d[g]]=c[d[g]];if("object"==typeof e)for(var h in e)f[h]=f[e[h]];a.refresh({skipIndexation:!1})}},Graphbrowser.Control.SigmaControl.prototype.updateEdge=function(b,c,d,e){var f=a.graph.edges(b);if(void 0!==f){if(c.id&&(f.id=c.id),c.source&&(f.source=c.source),c.target&&(f.target=c.target),c.size&&(f.size=c.size),c.type&&(f.type=c.type),c.relType&&(f.relType=c.relType),c.relName&&(f.relName=c.relName),c.color&&(f.color=c.color),c.label&&(f.label=c.label),$.isArray(d))for(var g=0;g<d.length;g++)f[d[g]]=c[d[g]];if("object"==typeof e)for(var h in e)f[h]=gNode[e[h]];a.refresh({skipIndexation:!1})}},Graphbrowser.Control.SigmaControl.prototype.getCameraRatio=function(){return a.camera.ratio},Graphbrowser.Control.SigmaControl.prototype.getNodes=function(){return a.graph.nodes()},Graphbrowser.Control.SigmaControl.prototype.getEdges=function(){return a.graph.edges()},Graphbrowser.Control.SigmaControl.prototype.getNode=function(b){var c;return c="string"==typeof b?a.graph.nodes(b):a.graph.nodes(b.id),c?c:null},Graphbrowser.Control.SigmaControl.prototype.getEdge=function(b){var c;return c="string"==typeof b?a.graph.edges(b):a.graph.edges(b.id),c?c:null},Graphbrowser.Control.SigmaControl.prototype.findRelationships=function(b,c,d){var e=[];return a.graph.edges().forEach(function(a){a.source!==b||a.target!==c||d&&a.relType!==d||e.push(a)}),e},Graphbrowser.Control.SigmaControl.prototype.changeSigmaSetting=function(b,c){"string"==typeof b&&(a.settings(b,c),a.refresh({skipIndexation:!0}))}}).call(window);var Graphbrowser=Graphbrowser||{};Graphbrowser.Control=Graphbrowser.Control||{},function(){"use strict";var a;Graphbrowser.Control.ConnectionControl=function(b){var c=this;c.name="ConnectionControl",a=b},Graphbrowser.Control.ConnectionControl.prototype.init=function(){var b=this;a.conn={getNodes:b.getNodes.bind(b),getData:b.getData.bind(b),saveGraphView:b.saveGraphView.bind(b),getGraphViews:b.getGraphViews.bind(b),getGraphViewData:b.getGraphViewData.bind(b),getSchemaInformation:b.getSchemaInformation.bind(b),createRelationship:b.createRelationship.bind(b),deleteRelationship:b.deleteRelationship.bind(b),getStructrPage:b.getStructrPage.bind(b),getRelationshipsOfType:b.getRelationshipsOfType.bind(b)}},Graphbrowser.Control.ConnectionControl.prototype.sendRequest=function(a,b,c,d){var e=void 0;return window.domainOnly&&window.domainOnly===!0&&(a+="?domainOnly=true"),void 0===d&&(d="application/json"),("object"==typeof c||"string"==typeof c||$.isArray(c))&&(e=JSON.stringify(c)),$.ajax({url:a,data:e||c,contentType:d,method:b})},Graphbrowser.Control.ConnectionControl.prototype.restRequest=function(a,b,c,d){a.done(function(a,d){b(a.result,c)}).fail(function(a,b,e){console.log("Graph-Browser-Rest: Status "+a.status+" - ERROR: "+e),d&&d(c,a.responseJSON.message)})},Graphbrowser.Control.ConnectionControl.prototype.htmlRequest=function(a,b,c,d){a.done(function(a,d){b(a,c)}).fail(function(a,b,e){console.log("Graph-Browser-Rest: Status "+a.status+" - ERROR: "+e),d&&d(c,a.responseJSON.message)})},Graphbrowser.Control.ConnectionControl.prototype.getNodes=function(a,b,c,d){var e=this;d||(d="_graph");var f="/structr/rest/"+a.id+"/"+b+"/"+d,g=e.sendRequest(f,"GET");e.restRequest(g,c,a)},Graphbrowser.Control.ConnectionControl.prototype.getData=function(a,b,c,d){var e,f=this,g="/structr/rest/";void 0===d&&(d="_graph"),$.isArray(a)?(g+="resolver",e="POST"):(g+=a.id+"/"+d,e="GET");var h=f.sendRequest(g,e,"POST"===e?a:void 0);f.restRequest(h,c,b)},Graphbrowser.Control.ConnectionControl.prototype.getGraphViews=function(a,b,c){var d=this,e="/structr/rest/GraphView/"+b+"/?viewSource="+a,f=d.sendRequest(e,"GET");d.restRequest(f,c)},Graphbrowser.Control.ConnectionControl.prototype.getGraphViewData=function(a,b,c){var d=this,e="/structr/rest/GraphView/"+b+"/"+a,f=d.sendRequest(e,"GET");d.restRequest(f,c)},Graphbrowser.Control.ConnectionControl.prototype.saveGraphView=function(a,b,c,d,e){var f=this,g={name:a,graph:b,data:c,viewSource:d},h="/structr/rest/GraphView",i=f.sendRequest(h,"POST",g,"application/json; charset=utf-8");f.restRequest(i,e)},Graphbrowser.Control.ConnectionControl.prototype.getSchemaInformation=function(a){var b=this,c="/structr/rest/_schema/",d=b.sendRequest(c,"GET");b.restRequest(d,a)},Graphbrowser.Control.ConnectionControl.prototype.getRelationshipsOfType=function(a,b,c){var d=this,e="/structr/rest/"+a,f=d.sendRequest(e,"GET");d.restRequest(f,b,void 0,c)},Graphbrowser.Control.ConnectionControl.prototype.deleteRelationship=function(a,b){var c=this,d="/structr/rest/"+a,e=c.sendRequest(d,"DELETE");c.restRequest(e,b)},Graphbrowser.Control.ConnectionControl.prototype.createRelationship=function(a,b,c,d,e,f){var g=this,h={sourceId:a,targetId:b},i="/structr/rest/"+c,j=g.sendRequest(i,"POST",h);g.restRequest(j,d,e,f)},Graphbrowser.Control.ConnectionControl.prototype.getStructrPage=function(a,b,c,d){var e=this,f="/"+a+"/"+b,g=e.sendRequest(f,"GET");e.htmlRequest(g,c,b,d)}}.call(window);var Graphbrowser=Graphbrowser||{};Graphbrowser.Control=Graphbrowser.Control||{},function(){"use strict";var a=void 0,b=void 0,c={},d=void 0,e={},f={},g={};Graphbrowser.Control.ModuleControl=function(c,g,h){var i=this;i.name="ModuleControl",a=h,e=c,d=0,b=g,f[a.id]={},sigma.classes.dispatcher.extend(f[a.id]),e.eventEmitter=f,f[a.id].bind("dataChanged",i.refreshSigma),f[a.id].bind("prepareSaveGraph",i.onSave),f[a.id].bind("restoreGraph",i.onRestore),f[a.id].bind("pickNodes",i.onPickNodes),e.bindBrowserEvent=i.bindBrowserEvent,e.refreshSigma=i.refreshSigma.bind(i),e.filterNodes=i.onFilterNodes.bind(i),e.undo=i.onUndo.bind(i),e.doLayout=i.doLayout.bind(i),e.api.dataChanged=i.onDataChanged.bind(i),e.api.doLayout=i.doLayout.bind(i)},Graphbrowser.Control.ModuleControl.prototype.init=function(){Graphbrowser.Modules&&$.each(Graphbrowser.Modules,function(d,f){var g=new f(a,e);g.init(b[g.name]),c[g.name]=g})},Graphbrowser.Control.ModuleControl.prototype.bindBrowserEvent=function(a,b){g[a]=g[a]||[],g[a].push(b)},Graphbrowser.Control.ModuleControl.prototype.onDataChanged=function(){f[a.id].dispatchEvent("dataChanged")},Graphbrowser.Control.ModuleControl.prototype.start=function(a){$.each(g.start,function(b,c){c(a)})},Graphbrowser.Control.ModuleControl.prototype.refreshSigma=function(){window.clearTimeout(d),d=window.setTimeout(function(){a.refresh({skipIndexation:!1})},50)},Graphbrowser.Control.ModuleControl.prototype.onPickNodes=function(a){var b=a.data.nodesToSelect,c=a.data.onNodesSelected,d=a.data.parentNode,e=a.data.parentTitle;return g.pickNodes?void $.each(g.pickNodes,function(a,f){f(b,c,d,e)}):void c(b,d)},Graphbrowser.Control.ModuleControl.prototype.onFilterNodes=function(a,b){return $.each(g.filterNodes,function(c,d){a=d(a,b)}),a},Graphbrowser.Control.ModuleControl.prototype.onUndo=function(){$.each(g.undo,function(a,b){b()})},Graphbrowser.Control.ModuleControl.prototype.doLayout=function(a,b){"string"==typeof a&&$.each(g.doLayout,function(c,d){d(a,b)})},Graphbrowser.Control.ModuleControl.prototype.onSave=function(a){var b=a.data.saveAsName,c={name:b};$.each(g.saveGraph,function(a,b){c[module.name]=b()}),f.dispatchEvent("saveGraph",c)},Graphbrowser.Control.ModuleControl.prototype.onRestore=function(a){var b=a.data.data;$.each(g.restoreGraph,function(a,c){c(b)})},Graphbrowser.Control.ModuleControl.prototype.status=function(){var a={};return $.each(g.status,function(b,c){a[module.name]=c()}),a},Graphbrowser.Control.ModuleControl.prototype.reset=function(){$.each(g.reset,function(a,b){b()})}}.call(window),function(a){"use strict";Graphbrowser=Graphbrowser||{};var b,c={},d={},e=function(e){var f=this;if(e===a)throw new Error("Graph-Browser: No settings specified!");if(e.sigmaSettings===a&&console.log("Graph-Browser: No settings for Sigma.js found. Starting with default."),e.moduleSettings===a)throw new Error("Graph-Browser: Settings for Graph-Browser-Modules are missing!");d.api=d.api||{},e&&(c.sigmaControl=new Graphbrowser.Control.SigmaControl(d,e)),b=c.sigmaControl.init(),c.connectionControl=new Graphbrowser.Control.ConnectionControl(d),c.connectionControl.init(),c.ModuleControl=new Graphbrowser.Control.ModuleControl(d,e.moduleSettings,b),c.ModuleControl.init();for(var g in d.api)f[g]=d.api[g]};if(e.prototype.refresh=function(){c.ModuleControl.refreshSigma(!1,!1)},e.prototype.start=function(a){c.ModuleControl.start(a),c.ModuleControl.refreshSigma(!1,!1)},e.prototype.getSigma=function(){return b},e.prototype.status=function(){return c.ModuleControl.status()},e.prototype.reset=function(){c.ModuleControl.reset()},"undefined"!=typeof this.GraphBrowser)throw"An object called GraphBrowser is already in the global scope.";this.GraphBrowser=e}.call(window);var Graphbrowser=Graphbrowser||{};Graphbrowser.Modules=Graphbrowser.Modules||{},function(){"use strict";var a,b,c,d,e=[],f=[],g=[];Graphbrowser.Modules.CurrentNodeTypes=function(d,e){var f=this;f.name="currentNodeTypes",a=d,b=e,c=""},Graphbrowser.Modules.CurrentNodeTypes.prototype.init=function(e){var f=this;e?(void 0!==e.container?f.createView(e.container):d=!0,c=void 0!==e.classes?e.classes:"",b.api.getCurrentNodeTypes=f.getCurrentNodeTypes.bind(f),b.api.getCurrentRelTypes=f.getCurrentRelTypes.bind(f),b.api.highlightNodeType=f.highlightNodeType.bind(f),b.api.unhighlightNodeType=f.unhighlightNodeType.bind(f),b.api.highlightRelType=f.highlightRelType.bind(f),b.api.unhighlightRelType=f.unhighlightRelType.bind(f),b.eventEmitter[a.id].bind("dataChanged",f.onDataChanged.bind(f)),b.eventEmitter[a.id].bind("start",f.start.bind(f))):d=!0},Graphbrowser.Modules.CurrentNodeTypes.prototype.start=function(){var a=this;a.onDataChanged()},Graphbrowser.Modules.CurrentNodeTypes.prototype.createView=function(a){d=!1,"#"!==a.charAt(0)&&(a="#"+a),$(a).append('<div id="currentNodeTypes-displayTypes" class="currentNodeTypes-displayTypes"></div>')},Graphbrowser.Modules.CurrentNodeTypes.prototype.onDataChanged=function(h){var i=this;e=[],g=[];var j=$("#currentNodeTypes-displayTypes");j.empty(),$.each(a.graph.nodes(),function(a,b){0===e.length&&(b.hidden===!0&&f.push(b.nodeType),e.push(b.nodeType));var c=!1;$.each(e,function(a,d){if(b.nodeType===d)return c=!0,!1}),c||(b.hidden===!0&&f.push(b.nodeType),e.push(b.nodeType))}),$.each(a.graph.edges(),function(a,b){0===g.length&&(b.hidden===!0&&f.push(b.relName),g.push(b.relName));var c=!1;$.each(g,function(a,d){if(b.relName===d)return c=!0,!1}),c||(b.hidden===!0&&f.push(b.relName),g.push(b.relName))}),d||$.each(e,function(a,d){j.append('<a id="currentNodeTypes-nodeType-btn-'+d+'" class="currentNodeTypesButton '+c+'" style="background-color: '+color[d]+'">'+d+"</a>");var e=$("#currentNodeTypes-nodeType-btn-"+d);f.indexOf(d)>-1&&(e.css("text-decoration","line-through"),b.eventEmitter.dispatchEvent("hideNodeType",{nodeType:d,value:!0})),e.on("click",function(){var a=f.indexOf(d);a>-1?($(this).css("text-decoration",""),f.splice(a,1)):(f.push(d),$(this).css("text-decoration","line-through")),b.eventEmitter.dispatchEvent("hideNodeType",{nodeType:d})}).on("mouseover",function(){i.highlightNodeType(d)}).on("mouseout",function(){i.unhighlightNodeType(d)})})},Graphbrowser.Modules.CurrentNodeTypes.prototype.getCurrentNodeTypes=function(){return e},Graphbrowser.Modules.CurrentNodeTypes.prototype.getCurrentRelTypes=function(){return g},Graphbrowser.Modules.CurrentNodeTypes.prototype.highlightNodeType=function(b){var c=this,d=[],e=null;a.graph.nodes().forEach(function(a){a.nodeType===b&&(d.push(a),e=c.colorLuminance(a.color,-.1))}),a.renderers[0].bind("render",function(b){a.renderers[0].halo({nodeHaloColor:e,nodeHaloSize:10,nodes:d})}),a.refresh({skipIndexation:!0})},Graphbrowser.Modules.CurrentNodeTypes.prototype.unhighlightNodeType=function(b){a.renderers[0].unbind("render"),a.refresh({skipIndexation:!0})},Graphbrowser.Modules.CurrentNodeTypes.prototype.highlightRelType=function(b){a.graph.edges().forEach(function(a){a.relName===b&&(a.active_color="#81ce25",a.active=!0)}),a.refresh({skipIndexation:!0})},Graphbrowser.Modules.CurrentNodeTypes.prototype.unhighlightRelType=function(b){a.graph.edges().forEach(function(c){c.relName===b&&(c.active_color=a.settings("defaultEdgeActiveColor"),c.active=!1)}),a.refresh({skipIndexation:!0})},Graphbrowser.Modules.CurrentNodeTypes.prototype.colorLuminance=function(a,b){var c=this;a=String(a).replace(/[^0-9a-f]/gi,""),b=b||0,a.length<6&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]);var d,e,f=c.convertToDec(a.substr(0,2)),g=c.convertToDec(a.substr(2,2)),h=c.convertToDec(a.substr(4,2)),i=c.desaturate(f,g,h,.5),j="#";for(e=0;e<3;e++)d=i[e],d=Math.round(Math.min(Math.max(0,d+d*b),255)).toString(16),j+=("00"+d).substr(d.length);return j},Graphbrowser.Modules.CurrentNodeTypes.prototype.convertToDec=function(a){return parseInt(a,16)},Graphbrowser.Modules.CurrentNodeTypes.prototype.desaturate=function(a,b,c,d){var e=.3*a+.59*b+.11*c;return a=Math.floor(e*d+a*(1-d)),b=Math.floor(e*d+b*(1-d)),c=Math.floor(e*d+c*(1-d)),[a,b,c]}}.call(window);var Graphbrowser=Graphbrowser||{};Graphbrowser.Modules=Graphbrowser.Modules||{},function(){"use strict";var a,b,c,d;Graphbrowser.Modules.Exporter=function(c,d){var e=this;e.name="exporter",a=c,b=d},Graphbrowser.Modules.Exporter.prototype.init=function(e){var f=this;e&&(c=void 0!==e.onSuccess&&"function"==typeof e.onSuccess?e.onSuccess:void 0,d=void 0!==e.onError&&"function"==typeof e.onError?e.onError:void 0,b.eventEmitter[a.id].bind("saveGraph",f.onSave.bind(f)),$(document).on("click","#exporter-saveGraph-form-submit",function(){f.triggerSave(!0)}))},Graphbrowser.Modules.Exporter.prototype.exportJson=function(){var b=["fr","fr_x","fr_y"],c=["color"];a.toJSON({removeNodeAttributes:b,removeEdgeAttributes:c})},Graphbrowser.Modules.Exporter.prototype.exportGefx=function(){a.toGEXF({download:!1,nodeAttributes:"data",edgeAttributes:"data",renderer:a.renderers[0],creator:"OP"})},Graphbrowser.Modules.Exporter.prototype.triggerSave=function(a){var c=$("#exporter-saveGraph-form-name").val();c&&0!==c.length?b.eventEmitter.dispatchEvent("prepareSaveGraph",{saveAsName:c}):void 0!==d&&d()},Graphbrowser.Modules.Exporter.prototype.onSave=function(c){var d=this,e=c.data.data;e.mode="all";var f=["fr","fr_x","fr_y"],g=["color"],h=a.toJSON({removeNodeAttributes:f,removeEdgeAttributes:g}),i=JSON.stringify(e);b.conn.saveGraphView(e.name,h,i,currentViewId,d.onGraphSaved.bind(d),!1)},Graphbrowser.Modules.Exporter.prototype.onGraphSaved=function(){void 0!==c&&c()}}.call(window);var Graphbrowser=Graphbrowser||{};Graphbrowser.Modules=Graphbrowser.Modules||{};var animating=animating||void 0;(function(){"use strict";var a,b,c=0,d=0;Graphbrowser.Modules.Fruchtermann=function(c,d){var e=this;e.name="fruchtermanReingold",b=d,a=c},Graphbrowser.Modules.Fruchtermann.prototype.init=function(){var a=this;b.bindBrowserEvent("doLayout",a.doLayout.bind(a)),$(document).on("click","#fruchterman-controlElement",function(){a.doLayout(1)})},Graphbrowser.Modules.Fruchtermann.prototype.start=function(){var a=this;a.doLayout(1)},Graphbrowser.Modules.Fruchtermann.prototype.doLayout=function(a,b){var c=this;a===c.name&&(b?c.restartLayout(b):c.restartLayout(20))},Graphbrowser.Modules.Fruchtermann.prototype.restartLayout=function(e){var f=this,g={autoArea:!1,area:1e9,gravity:0,speed:.1,iterations:1500,easing:"quadraticInOut",duration:800},h=sigma.layouts.fruchtermanReingold.configure(a,g);h.bind("stop",function(c){window.clearTimeout(d),d=window.setTimeout(function(){d&&(d=0,b.eventEmitter[a.id].dispatchEvent("dataChanged"))},50)}),window.setTimeout(function(){animating=!0,sigma.layouts.fruchtermanReingold.start(a),animating=!1,c++<e?f.restartLayout(e):c=0},40)}}).call(window);var Graphbrowser=Graphbrowser||{};Graphbrowser.Modules=Graphbrowser.Modules||{},function(){"use strict";var a,b,c,d,e;Graphbrowser.Modules.Importer=function(c,d){var e=this;e.name="importer",a=c,b=d},Graphbrowser.Modules.Importer.prototype.init=function(a){var b=this;a&&(d=void 0!==a.onSuccess&&"function"==typeof a.onSuccess?a.onSuccess:void 0,e=void 0!==a.onError&&"function"==typeof a.onError?a.onError:void 0,$(document).on("click","#importer-controlElement",function(){b.loadGraphviewsForCurrent()}),$(document).on("click","#importer-loadGraph-submit",function(){c="all",b.loadSelectedView()}))},Graphbrowser.Modules.Importer.prototype.loadGraphviewsForCurrent=function(){var a=this;b.conn.getGraphViews(currentViewId,"graphBrowserInfo",a.pickGraphView.bind(a))},Graphbrowser.Modules.Importer.prototype.pickGraphView=function(a){var b="";a.length<=0&&(b+="<div><span>Keine Ansichten verf√ºgbar</span></div>"),$.each(a,function(a,c){b=b+'<div class="radiobutton importer-loadGraph-radiobuttons"><label><input type="radio"  name="viewButtons" value="'+c.id+'">'+c.name+"</label><div>"}),$("#importer-loadGraph-graphNames").append(b),b=""},Graphbrowser.Modules.Importer.prototype.loadSelectedView=function(){var a=this,c=$("#importer-loadGraph-graphNames input[type='radio']:checked").val();void 0!==c&&b.conn.getGraphViewData(c,"graphBrowser",a.restoreGraph.bind(a))},Graphbrowser.Modules.Importer.prototype.restoreGraph=function(c){var e=JSON.parse(c.graph),f=JSON.parse(c.data);a.graph.clear(),a.graph.read(e),b.eventEmitter[a.id].dispatchEvent("restoreGraph",f),b.eventEmitter[a.id].dispatchEvent("dataChanged"),a.refresh(),d()}}.call(window);var Graphbrowser=Graphbrowser||{};Graphbrowser.Modules=Graphbrowser.Modules||{},function(){"use strict";var a,b,c,d,e,f,g,h;Graphbrowser.Modules.NewNodesPicker=function(c,d){var e=this;e.name="newNodePicker",a=c,b=d},Graphbrowser.Modules.NewNodesPicker.prototype.init=function(a){var c=this;a&&(g=void 0!==a.onFinished&&"function"==typeof a.onFinished?a.onFinished:void 0,h=void 0!==a.onChooseNodes&&"function"==typeof a.onChooseNodes?a.onChooseNodes:void 0,$(document).on("click","#newnodepicker-chooseNodes-markAllSelected",function(){c.onMarkAllSelected()}),$(document).on("click","#newnodepicker-chooseNodes-reverseSelection",function(){c.onReverseSelection()}),$(document).on("click","#newnodepicker-chooseNodes-submit",function(){c.onSelected()}),b.bindBrowserEvent("pickNodes",c.pickNodes.bind(c)))},Graphbrowser.Modules.NewNodesPicker.prototype.isActive=function(){return this.active},Graphbrowser.Modules.NewNodesPicker.prototype.pickNodes=function(b,g,i,j){var k=this;if(!(b.length<=0)){d=b,c=g,e=i,f=j;var l=[];j&&$("#newnodepicker-chooseNodes-parentNodeTitle").replaceWith('<h3 id="newnodepicker-chooseNodes-parentNodeTitle" class="newnodepicker-chooseNodes-parentNodeTitle">'+j+"</h3>"),$("#newnodepicker-chooseNodes-items").empty(),$.each(d,function(b,c){l.indexOf(c.nodeType)<0&&(l.push(c.nodeType),$("#newnodepicker-chooseNodes-items").append('<div id="newnodepicker-chooseNodes-itemType-'+c.nodeType+'" class="newnodepicker-chooseNodes-itemType newnodepicker-chooseNodes-itemType-'+c.nodeType+'"><h4 id="newnodepicker-chooseNodes-itemType-header-'+c.nodeType+'" class="newnodepicker-chooseNodes-itemType-header newnodepicker-chooseNodes-itemType-header-'+c.nodeType+'">'+c.nodeType+"</h4></div>"),$("#newnodepicker-chooseNodes-itemType-header-"+c.nodeType).on("click",function(){k.onMarkTypeSelected(c.nodeType)}));var d=!1;return $("input[name='selectedNodeItems[]']").each(function(){$(this).val()===c.id&&(d=!0)}),!!d||void(a.graph.nodes(c.id)?$("#newnodepicker-chooseNodes-itemType-"+c.nodeType).append('<div class="checkbox newnodepicker-chooseNodes-item newnodepicker-chooseNodes-item-'+c.nodeType+'"><label class="newnodepicker-chooseNodes-item-label"><input type="checkbox" disabled name="selectedNodeItems[]" value="'+c.nodeType+"."+c.id+'">'+c.label+"</label></div>"):d||a.graph.nodes(c.id)||$("#newnodepicker-chooseNodes-itemType-"+c.nodeType).append('<div class="checkbox newnodepicker-chooseNodes-item newnodepicker-chooseNodes-item-'+c.nodeType+'"><label><input type="checkbox" name="selectedNodeItems[]" value="'+c.nodeType+"."+c.id+'">'+c.label+"</label></div>"))}),void 0!=h&&h(e,f)}},Graphbrowser.Modules.NewNodesPicker.prototype.onSelected=function(){var a=this;$("input[name='selectedNodeItems[]']:not(:checked)").each(function(){var a=$(this).val().split(".");d=d.filter(function(b){return b.id!==a[1]})}),void 0!==g&&g(e,f),void 0!==c&&c(d,e),a.clear()},Graphbrowser.Modules.NewNodesPicker.prototype.onMarkAllSelected=function(){$("input[name='selectedNodeItems[]']").each(function(){return $(this).prop("disabled")===!0||void $(this).prop("checked",!0)})},Graphbrowser.Modules.NewNodesPicker.prototype.onMarkTypeSelected=function(a){$("input[name='selectedNodeItems[]']").each(function(){var b=$(this).val().split(".");return $(this).prop("disabled")===!0||void(b[0]===a&&$(this).prop("checked",!$(this).prop("checked")))})},Graphbrowser.Modules.NewNodesPicker.prototype.onReverseSelection=function(){$("input[name='selectedNodeItems[]']").each(function(){return $(this).prop("disabled")===!0||void $(this).prop("checked",!$(this).prop("checked"))})},Graphbrowser.Modules.NewNodesPicker.prototype.clear=function(){c=void 0,d=void 0,e=void 0,f=void 0}}.call(window);var Graphbrowser=Graphbrowser||{};Graphbrowser.Modules=Graphbrowser.Modules||{};var animating=animating||void 0;(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o={},p={},q=!1,r=!1,s=!1,t=!0,u=[],v=[],w=[];Graphbrowser.Modules.NodeExpander=function(c,d){var e=this;e.name="nodeExpander",a=c,b=d},Graphbrowser.Modules.NodeExpander.prototype.init=function(i){var j=this;i&&(c=void 0!==i.container?i.container:"",d=void 0!==i.margins.left?i.margins.left:0,e=void 0!==i.margins.top?i.margins.top:0,f=void 0!==i.onAddNodes?i.onAddNodes:void 0,g=void 0!==i.onNodesAdded?i.onNodesAdded:void 0,h=void 0!==i.onNodesRemoved?i.onNodesRemoved:void 0,l=void 0!==i.newNodeSize?i.newNodeSize:10,n=void 0!==i.newEdgeSize?i.newEdgeSize:10,m=void 0!==i.edgeType?i.edgeType:"arrow",void 0!==i.nodesShape?(k=j.nodesShape,CustomShapes.init(a)):k="",b.bindBrowserEvent("restoreGraph",j.onRestore.bind(j)),b.bindBrowserEvent("saveGraph",j.onSave.bind(j)),b.bindBrowserEvent("reset",j.onReset.bind(j)),b.eventEmitter[a.id].bind("dataChanged",j.onDataChanged.bind(j)),b.eventEmitter[a.id].bind("undo",j.onUndo.bind(j)),j.bindEvents(),"#"!==c.charAt(0)&&(c="#"+c)),b.api.expandNode=j.expandNode.bind(j),b.api.collapseNode=j.collapseNode.bind(j),b.api.hideExpandButtons=j.hideExpandButtons.bind(j)},Graphbrowser.Modules.NodeExpander.prototype.bindEvents=function(){var a=this;b.sigmaCtrl.bindSigmaEvent("clickNode",a.handleClickNodeEvent.bind(a)),b.sigmaCtrl.bindSigmaEvent("doubleClickNode",a.handleDoubleClickNodeEvent.bind(a)),b.sigmaCtrl.bindSigmaEvent("hovers",a.handleHoversEvent.bind(a))},Graphbrowser.Modules.NodeExpander.prototype.unbindEvents=function(){var a=this;b.sigmaCtrl.unbindSigmaEvent("clickNode",a.handleClickNodeEvent.bind(a)),b.sigmaCtrl.unbindSigmaEvent("doubleClickNode",a.handleDoubleClickNodeEvent.bind(a)),b.sigmaCtrl.unbindSigmaEvent("hovers",a.handleHoversEvent.bind(a))},Graphbrowser.Modules.NodeExpander.prototype.handleClickNodeEvent=function(a){a.data.node},Graphbrowser.Modules.NodeExpander.prototype.handleDoubleClickNodeEvent=function(c){var d=this,e=c.data.node,f=e.id;$("#graph-info").empty(),o[f]&&"expanded"===o[f].state?(d.collapseNode(e),b.eventEmitter[a.id].dispatchEvent("dataChanged",{source:d.name}),void 0!==h&&"function"==typeof _inNodesRemoved&&_inNodesRemoved()):d.onExpandNode(e)},Graphbrowser.Modules.NodeExpander.prototype.handleHoversEvent=function(a){var b=this;a.data.enter.nodes.length>0?b.handleOverNodeEvent(a.data.enter.nodes[0]):a.data.leave.nodes.length>0&&b.handleOutNodeEvent(a.data.leave.nodes[0])},Graphbrowser.Modules.NodeExpander.prototype.handleOverNodeEvent=function(a){var d=this;if(q=!0,i="overNode",p={},u=[],window.clearTimeout(j),j=0,$(c).empty(),!o[a.id]||"expanded"!==o[a.id].state){$(c).append("<span>Loading...</span>");b.conn.getNodes(a,"in",d.onNewInNodesLoaded.bind(d)),b.conn.getNodes(a,"out",d.onNewOutNodesLoaded.bind(d))}},Graphbrowser.Modules.NodeExpander.prototype.handleOutNodeEvent=function(a){j||(j=window.setTimeout(function(){j&&(j=0,$(c).empty(),q=!1)},1e3))},Graphbrowser.Modules.NodeExpander.prototype.onNewOutNodesLoaded=function(c,d){var e=this;s=!0;c=b.filterNodes(c,"out"),$.each(c,function(b,c){a.graph.nodes(c.targetNode.id)||(p[c.targetNode.type]?p[c.targetNode.type]++:p[c.targetNode.type]=1)}),u.outNodes=c,s&&r&&t&&(r=!1,s=!1,e.updateHoverInfo(d,p))},Graphbrowser.Modules.NodeExpander.prototype.onNewInNodesLoaded=function(c,d){var e=this;r=!0;c=b.filterNodes(c,"in"),$.each(c,function(b,c){a.graph.nodes(c.sourceNode.id)||(p[c.sourceNode.type]?p[c.sourceNode.type]++:p[c.sourceNode.type]=1)}),u.inNodes=c,s&&r&&t&&(r=!1,s=!1,e.updateHoverInfo(d,p))},Graphbrowser.Modules.NodeExpander.prototype.updateHoverInfo=function(a,b){var f=this;q=!1;var g=$(c),h=Object.keys(b).length,i=0,j=a["renderer1:size"],k=Math.max(j,40),l=Math.floor(a["renderer1:x"]),m=a["renderer1:y"],n=0;switch(h){case 2:n=Math.PI/8*7;break;case 3:n=Math.PI/4*3;break;case 4:n=Math.PI/8*5;break;case 5:n=Math.PI/8*4;break;case 6:n=Math.PI/8*3;break;case 7:n=Math.PI/8*7;break;default:n=Math.PI}h<8&&(h=8),g.empty(),$.each(b,function(b,c){var j=b+" ("+c+")",o=n+2*Math.PI/h*i,p=Math.cos(o),r=Math.sin(o),s=p*k-15,t=r*k-15;g.append('<button class="nodeExpander-expandbutton" id="'+b+'-button" style="position: absolute; top: 0px; left: 0px; z-index: 10000;" title="'+j+'">'+c+"</button>"),g.append('<button class="btn btn-xs nodeExpander-infobutton" style="margin: 4px; color: #000; background-color: '+color[b]+'">'+j+"</button>");var u=$("#"+b+"-button");u.css("border","none"),u.css("background-color",color[b]),u.css("color","#000"),u.css("top",m+t+e+"px"),u.css("left",l+s+d+"px"),u.on("click",function(c){g.empty(),f.onExpandNode(a,b),q=!1}),i++})},Graphbrowser.Modules.NodeExpander.prototype.collapseNode=function(b){var c=this;if("string"==typeof b&&(b=a.graph.nodes(b)),b){var d=b.id;if(o[d]&&"expanded"===o[d].state){var e=o[d].edges,f=o[d].nodes;$.each(e,function(b,c){try{a.graph.dropEdge(c)}catch(d){}}),$.each(f,function(b,d){c.collapseNode(a.graph.nodes(d));try{a.graph.dropNode(d)}catch(e){}}),o[d].state="collapsed"}}a.refresh()},Graphbrowser.Modules.NodeExpander.prototype.onExpandNode=function(a,b){var c=this;if(u.inNodes||u.outNodes){var d=(a.id,a.x),e=a.y,f=[],g=[];$.each(u.outNodes,function(a,h){b&&h.targetNode.type!==b||c.addOutNode(f,g,h,d,e)}),$.each(u.inNodes,function(a,h){b&&h.sourceNode.type!==b||c.addInNode(f,g,h,d,e)}),c.pickNodes(a,f,g),t=!0}},Graphbrowser.Modules.NodeExpander.prototype.onNodesSelected=function(a,b){var c=this;!a||a.length<=0||(o[b]={state:"expanded",id:b,nodes:o[b]?o[b].nodes:[],edges:o[b]?o[b].edges:[]},c.addNodesToGraph(b,a,v))},Graphbrowser.Modules.NodeExpander.prototype.pickNodes=function(c,d,e){var f=this;u=[],u=$.extend(u,d),v=$.extend(v,e),b.eventEmitter[a.id].dispatchEvent("pickNodes",{nodesToSelect:u,
onNodesSelected:f.onNodesSelected.bind(f),parentNode:c.id,parentTitle:c.label})},Graphbrowser.Modules.NodeExpander.prototype.addOutNode=function(b,c,d,e,f){var g=d.sourceNode,h=d.targetNode,i=Math.random()*Math.PI*2,j=a.camera.ratio,k=0,o=0;j>1&&(k=e+Math.cos(i)*(Math.abs(e)/(2*j)),o=f+Math.sin(i)*(Math.abs(f)/(2*j))),j<=1&&(k=e+Math.cos(i)*(Math.abs(e)/(1/j)),o=f+Math.sin(i)*(Math.abs(f)/(1/j)));var p=l;b.push({id:h.id,label:h.name,size:p,x:k,y:o,color:color[h.type],nodeType:h.type}),c.push({id:d.id,source:g.id,target:h.id,size:n,relType:d.type,label:d.relType,type:m,color:a.settings("defaultEdgeColor")})},Graphbrowser.Modules.NodeExpander.prototype.addInNode=function(b,c,d,e,f){var g=d.sourceNode,h=d.targetNode,i=Math.random()*Math.PI*2,j=a.camera.ratio,k=0,o=0;j>1&&(k=e+Math.cos(i)*(Math.abs(e)/(2*j)),o=f+Math.sin(i)*(Math.abs(f)/(2*j))),j<=1&&(k=e+Math.cos(i)*(Math.abs(e)/(1/j)),o=f+Math.sin(i)*(Math.abs(f)/(1/j)));var p=l;b.push({id:g.id,label:g.name,size:p,x:k,y:o,color:color[g.type],nodeType:g.type}),c.push({id:d.id,source:g.id,target:h.id,size:n,relType:d.type,label:d.relType,type:m,color:a.settings("defaultEdgeColor")})},Graphbrowser.Modules.NodeExpander.prototype.addEdge=function(b){var c=b.sourceNode,d=b.targetNode;b.id;edges[b.id]={id:b.id,source:c.id,target:d.id,size:n,relType:b.type,label:b.relType,type:m,color:a.settings("defaultEdgeColor")}},Graphbrowser.Modules.NodeExpander.prototype.addNodesToGraph=function(c,d,e){var h=this,i=0;void 0!==f&&"function"==typeof f&&f(c),$.each(d,function(b,d){try{a.graph.addNode({id:d.id,label:d.label,size:d.size,x:d.x,y:d.y,color:d.color,nodeType:d.nodeType,type:k}),o[c].nodes.push(d.id),i++}catch(e){}}),$.each(e,function(d,e){var f=b.api.findRelationships(e.source,e.target),g=10*f.length;try{a.graph.addEdge({id:e.id,source:e.source,target:e.target,label:e.label,type:e.type,color:e.color,relType:e.relType,relName:e.label,size:e.size,count:g}),o[c].edges.push(e.id),i++}catch(h){}}),u=[],v=[],sigma.canvas.edges.autoCurve(a),b.eventEmitter[a.id].dispatchEvent("dataChanged",{source:h.name}),void 0!==g&&"function"==typeof g&&g()},Graphbrowser.Modules.NodeExpander.prototype.onUndo=function(){w.length<1||(w.splice(w.length-1,1),o=w[w.length-1],o||(o={}))},Graphbrowser.Modules.NodeExpander.prototype.onDataChanged=function(a){var b=this,c=a.data.source;if("undo"!==c&&c===b.name){var d=jQuery.extend({},o);w.push(d)}},Graphbrowser.Modules.NodeExpander.prototype.onSave=function(){var a=JSON.stringify(o);return a},Graphbrowser.Modules.NodeExpander.prototype.onRestore=function(a){var b=a[self.name],c=JSON.parse(b);o=c},Graphbrowser.Modules.NodeExpander.prototype.onReset=function(){w=[],Object.keys(o).forEach(function(a){delete o[a]})},Graphbrowser.Modules.NodeExpander.prototype.expandNode=function(c){var d=this,e=a.graph.nodes(c);t=!1;b.conn.getNodes(e,"in",d.onNewInNodesLoaded.bind(d)),b.conn.getNodes(e,"out",d.onNewOutNodesLoaded.bind(d));window.setTimeout(function(){d.onExpandNode(e)},20)},Graphbrowser.Modules.NodeExpander.prototype.hideExpandButtons=function(){$(c).empty()}}).call(window);var Graphbrowser=Graphbrowser||{};Graphbrowser.Modules=Graphbrowser.Modules||{},function(){"use strict";var a,b,c,d,e,f={},g={},h={},i={};Graphbrowser.Modules.NodeFilter=function(c,d){var e=this;e.name="nodeFilter",a=c,b=d},Graphbrowser.Modules.NodeFilter.prototype.init=function(f){var g=this;f?(d=void 0!==f.filterType&&("whitelist"===f.filterType||"blacklist"===f.filterType)?f.filterType:"blacklist",c=void 0===f.filterOnStart||f.filterOnStart,e=void 0!==f.filterNodeTypes?f.filterNodeTypes:[]):(d="blacklist",c=!1,e=[]),b.eventEmitter[a.id].bind("hideNodeType",g.hideNodeType.bind(g)),b.eventEmitter[a.id].bind("hideNodes",g.hideNodes.bind(g)),b.bindBrowserEvent("filterNodes",g.filterNodes.bind(g)),b.bindBrowserEvent("start",g.start.bind(g)),b.api.addNodeTypeToFilter=g.addNodeTypeToFilter.bind(g),b.api.removeNodeTypeFromFilter=g.removeNodeTypeFromFilter.bind(g),b.api.setFilterType=g.setFilterType.bind(g),b.api.addNodeTypeToFilter=g.addNodeTypeToFilter.bind(g),b.api.removeNodeTypeFromFilter=g.removeNodeTypeFromFilter.bind(g),b.api.clearFilterNodeTypes=g.clearFilterNodeTypes.bind(g),b.api.filterGraph=g.filterGraph.bind(g),b.api.hideNodes=g.hideNodes.bind(g),b.api.hideNode=g.hideNode.bind(g),b.api.hideNodeType=g.hideNodeType.bind(g),b.api.hideRelType=g.hideRelType.bind(g),b.api.hideRels=g.hideRels.bind(g)},Graphbrowser.Modules.NodeFilter.prototype.filterNodes=function(a,b){var c=this;return"in"===b?c.filterNewInNodes(a):"out"===b?c.filterNewOutNodes(a):void 0},Graphbrowser.Modules.NodeFilter.prototype.filterNewInNodes=function(a){return a&&$.each(e,function(b,c){a=a.filter(function(a){if("blacklist"===d)return a.sourceNode.type!==c;if(a.sourceNode.type!==c){var b=!1;return $.each(e,function(c,d){a.sourceNode.type===d&&(b=!0)}),b}return!0})}),a},Graphbrowser.Modules.NodeFilter.prototype.filterNewOutNodes=function(a){return a&&$.each(e,function(b,c){a=a.filter(function(a){if("blacklist"===d)return a.targetNode.type!==c;if(a.targetNode.type!==c){var b=!1;return $.each(e,function(c,d){a.targetNode.type===d&&(b=!0)}),b}return!0})}),a},Graphbrowser.Modules.NodeFilter.prototype.addNodeTypeToFilter=function(a){void 0!==a&&e.push(a)},Graphbrowser.Modules.NodeFilter.prototype.setFilterType=function(a){void 0!==a&&("whitelist"!==a&&"blacklist"!==a||(d=a))},Graphbrowser.Modules.NodeFilter.prototype.removeNodeTypeFromFilter=function(a){void 0!==a&&e.splice(e.indexOf(a),1)},Graphbrowser.Modules.NodeFilter.prototype.clearFilterNodeTypes=function(){e=[]},Graphbrowser.Modules.NodeFilter.prototype.hideNodeType=function(b){var c=b.data.nodeType,d=b.data.value;d?f[c]=d:f[c]?f[c]=!f[c]:f[c]=!0,$.each(a.graph.nodes(),function(a,b){if(b.nodeType===c){if(void 0!==g[b.id]&&g[b.id].hidden===!0)return!0;b.hidden=f[c]}}),a.refresh({skipIndexation:!0})},Graphbrowser.Modules.NodeFilter.prototype.hideNodes=function(b){var c=b.data.nodes,d=b.data.status;$.each(c,function(b,c){$.each(a.graph.nodes(),function(a,b){if(c.id===b.id)return f[c.nodeType]===!0||(g[c.id]={},g[c.id].hidden=d,b.hidden=d,!1)})}),a.refresh({skipIndexation:!0})},Graphbrowser.Modules.NodeFilter.prototype.hideRelType=function(b,c){c?h[b]=c:h[b]?h[b]=!h[b]:h[b]=!0,$.each(a.graph.edges(),function(a,c){if(c.relName===b){if(void 0!==i[c.id]&&i[c.id].hidden===!0)return!0;c.hidden=h[b]}}),a.refresh({skipIndexation:!0})},Graphbrowser.Modules.NodeFilter.prototype.hideRels=function(b,c){$.each(b,function(b,d){$.each(a.graph.edges(),function(a,b){if(d.id===b.id)return h[d.relName]===!0||(i[d.id]={},i[d.id].hidden=c,b.hidden=c,!1)})}),a.refresh({skipIndexation:!0})},Graphbrowser.Modules.NodeFilter.prototype.filterGraph=function(){var c=[];$.each(e,function(b,f){$.each(a.graph.nodes(),function(a,b){if(b.nodeType===f&&"blacklist"===d&&c.push(b.id),b.nodeType!==f&&"whitelist"===d){var g=!0;$.each(e,function(a,c){b.nodeType===c&&(g=!1)}),g&&c.push(b.id)}})}),$.each(c,function(b,c){a.graph.dropNode(c)}),b.refreshSigma(!1,!0)},Graphbrowser.Modules.NodeFilter.prototype.hideNode=function(b,c){var d=a.graph.nodes(b);d&&(d.hidden=c,a.refresh({skipIndexation:!0}))},Graphbrowser.Modules.NodeFilter.prototype.start=function(){var a=this;c&&e.length>0&&a.filterGraph()}}.call(window);var Graphbrowser=Graphbrowser||{};Graphbrowser.Modules=Graphbrowser.Modules||{},function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l;Graphbrowser.Modules.RelationshipEditor=function(c,d){e=this,this.name="relationshipEditor",e.active=!0,a=c,b=d},Graphbrowser.Modules.RelationshipEditor.prototype.init=function(a){var b=this;if(a){if(f=void 0!==a.incommingRelationsKey?a.incommingRelationsKey:"shiftKey",g=void 0!==a.outgoingRelationsKey?a.outgoingRelationsKey:"ctrlKey",i=void 0!==a.deleteEvent?a.deleteEvent:"rightClickEdges",j=void 0!==a.onDeleteRelation?a.onDeleteRelation:void 0,k=void 0!==a.maxDistance?a.maxDistance:200,void 0===typeof b.getRelationshipEditorWorker)throw new Error("Graph-Browser-RelationshipEditor: Worker not found.");h={shiftKey:!1,ctrlKey:!1,altKey:!1,noKey:!0},l=!1,b.active=!0,b.bindEvents()}else b.active=!1},Graphbrowser.Modules.RelationshipEditor.prototype.bindEvents=function(){var c=this;b.sigmaCtrl.bindSigmaEvent("keyup",e.handleKeyEvent),b.sigmaCtrl.bindSigmaEvent("keydown",e.handleKeyEvent),b.sigmaCtrl.bindSigmaEvent(i,e.handleSigmaEvent),b.eventEmitter[a.id].bind("dataChanged",c.onDataChanged.bind(c))},Graphbrowser.Modules.RelationshipEditor.prototype.start=function(){var a=this;a.active&&b.conn.getSchemaInformation(this.onSchemaInformationLoaded)},Graphbrowser.Modules.RelationshipEditor.prototype.startWorker=function(){var a=e.getRelationshipEditorWorker();if(window.Worker){var d=new Blob([a],{type:"application/javascript"});c=new Worker(URL.createObjectURL(d)),c.onmessage=e.onmessage,b.conn.getSchemaInformation(this.onSchemaInformationLoaded)}else console.log("Graph-Browser-RelationshipEditor: It seems that your browser does not support webworkers.")},Graphbrowser.Modules.RelationshipEditor.prototype.stopWorker=function(){c&&c.terminate()},Graphbrowser.Modules.RelationshipEditor.prototype.active=function(){e.active=!0},Graphbrowser.Modules.RelationshipEditor.prototype.deactivate=function(){e.active=!1},Graphbrowser.Modules.RelationshipEditor.prototype.handleKeyEvent=function(d){h=d,h.noKey||l?c&&(l=!1,b.sigmaCtrl.unbindSigmaEvent("startdrag",e.handleSigmaEvent),b.sigmaCtrl.unbindSigmaEvent("drag",e.handleSigmaEvent),b.sigmaCtrl.unbindSigmaEvent("dragend",e.handleSigmaEvent),c.postMessage({msg:"removeNewEdges",edges:a.graph.edges(),nodes:a.graph.nodes()}),window.setTimeout(function(){e.stopWorker()},50)):(l=!0,e.startWorker(),b.sigmaCtrl.bindSigmaEvent("startdrag",e.handleSigmaEvent),b.sigmaCtrl.bindSigmaEvent("drag",e.handleSigmaEvent),b.sigmaCtrl.bindSigmaEvent("dragend",e.handleSigmaEvent))},Graphbrowser.Modules.RelationshipEditor.prototype.handleSigmaEvent=function(b){if(e.active)switch(b.type){case"startdrag":c&&c.postMessage({msg:"updateGraphInfo",nodes:a.graph.nodes(),edges:a.graph.edges()});case"drag":c&&c.postMessage({msg:"handleDrag",dragedNode:b.data.node,keys:h,cameraRatio:a.camera.ratio});break;case"dragend":e.handleDragend(b.data.node);break;case i:e.handleEdgeDeleteEvent(b.data.edge)}},Graphbrowser.Modules.RelationshipEditor.prototype.onmessage=function(a){var b=a.data.msg;switch(b){case"add":e.addNewEdge(a.data.edge,a.data.remove);break;case"removeNewEdge":e.removeNewEdge(a.data.edge);break;case"hideEdge":e.hideEdge(a.data.edge);break;case"unhideEdge":e.unhideEdge(a.data.edge);break;case"debug":console.log(a.data.text)}},Graphbrowser.Modules.RelationshipEditor.prototype.addNewEdge=function(b,c){if(void 0!==c)var d=a.graph.edges(c);d&&(d.lock||a.graph.dropEdge(c)),a.graph.edges(b.id)||a.graph.addEdge(b),sigma.canvas.edges.autoCurve(a),a.refresh({skipIndexation:!1}),e.onDataChanged()},Graphbrowser.Modules.RelationshipEditor.prototype.removeNewEdge=function(b){var c=a.graph.edges(b);c&&(c.lock||a.graph.dropEdge(b)),sigma.canvas.edges.autoCurve(a),a.refresh({skipIndexation:!1}),e.onDataChanged()},Graphbrowser.Modules.RelationshipEditor.prototype.hideEdge=function(b){var c=a.graph.edges(b);c.hidden||(c.hidden=!0,sigma.canvas.edges.autoCurve(a),a.refresh({skipIndexation:!0}))},Graphbrowser.Modules.RelationshipEditor.prototype.unhideEdge=function(b){var c=a.graph.edges(b)||{};c.hidden&&(c.hidden=!1,sigma.canvas.edges.autoCurve(a),a.refresh({skipIndexation:!0}))},Graphbrowser.Modules.RelationshipEditor.prototype.handleEdgeDeleteEvent=function(c,d){var f=a.renderers[0].container;if($("body").on("contextmenu",f,function(a){return!1}),void 0!==j&&void 0===d){var g=a.graph.nodes(c.source),h=a.graph.nodes(c.target);j(c,g,h,e.handleEdgeDeleteEvent)}d&&b.conn.deleteRelationship(c.id,function(b){console.log("DeleteEdgeEvent: "+c.id),a.graph.dropEdge(c.id),sigma.canvas.edges.autoCurve(a),a.refresh({skipIndexation:!1}),e.onDataChanged()})},Graphbrowser.Modules.RelationshipEditor.prototype.handleDragend=function(d){$.each(a.graph.edges(),function(d,f){f.added&&(f.lock=!0,c.postMessage({msg:"commitNewEdge",edge:f.id}),b.conn.createRelationship(f.source,f.target,f.relType,function(b){var c=f;a.graph.dropEdge(f.id),c.id=b[0],c.color=a.settings("defaultEdgeColor"),c.size=a.settings("newEdgeSize"),c.type=a.settings("newEdgeType"),c.added=!1,c.replaced=void 0,c.lock=!1,c.cc=void 0,a.graph.addEdge(c),a.refresh({skipIndexation:!1}),sigma.canvas.edges.autoCurve(a),e.onDataChanged()},f.id,e.onErrorCreatingRelation))})},Graphbrowser.Modules.RelationshipEditor.prototype.onSchemaInformationLoaded=function(b){d={},$.each(b,function(a,b){d[b.type]=b}),c.postMessage({msg:"init",settings:{schema:d,maxDistance:k,nodes:a.graph.nodes(),edges:a.graph.edges()}})},Graphbrowser.Modules.RelationshipEditor.prototype.onDataChanged=function(b){c&&c.postMessage({msg:"updateGraphInfo",nodes:a.graph.nodes(),edges:a.graph.edges()})},Graphbrowser.Modules.RelationshipEditor.prototype.onErrorCreatingRelation=function(c,d){if("Relationship already exists"===d){var e=a.graph.edges(c);b.conn.getRelationshipsOfType(e.relType,function(b){$.each(b,function(b,d){return d.sourceId===e.source&&d.targetId===e.target?(void 0===a.graph.edges(d.id)&&(a.graph.addEdge({id:d.id,source:d.sourceId,target:d.targetId,relType:d.relType,label:d.relType,size:a.settings("newEdgeSize"),type:a.settings("newEdgeType"),color:a.settings("defaultEdgeColor"),cc:void 0}),sigma.canvas.edges.autoCurve(a)),!1):void(a.graph.edges(c)&&a.graph.dropEdge(c))})})}else a.graph.dropEdge(c);b.eventEmitter[a.id].dispatchEvent("dataChanged")}}.call(window),function(){"use strict";function a(){return";("+b.toString()+").call(this);"}var b=function(a){function b(a){l=void 0!==a.schema?a.schema:[],m=void 0!==a.maxDistance?a.maxDistance:200,n=void 0!==a.nodes?a.nodes:[],o=void 0!==a.edges?a.edges:[],q=void 0,p=void 0}function c(a,b,c){p=a,q=b}function d(a,b,c){if(n=p||n,o=q||o,l){for(var d=l[a.nodeType],f=0;f<n.length;f++)if(a.id!==n[f].id){var h=g(n[f],a),j=m,k="not",t=void 0,u=void 0,v=void 0,w=void 0,x=void 0;if(void 0===d)return;switch(c>1&&(h*=c),c<1&&(h/=1/c),b.shiftKey===!0&&h<=j?k="to":b.ctrlKey===!0&&h<=j&&(k="from"),k){case"from":if(void 0!==d.relatedFrom){for(var y,z=j/d.relatedFrom.length,A=d.relatedFrom.length-1;A>=0;)h<A*z&&(y=A),A--;var v=d.relatedFrom[y],B=y+":"+n[f].id+":"+a.id;t="allSourceTypesPossible",u="possibleSourceTypes",x=a.id,w=n[f].id}break;case"to":if(void 0!==d.relatedTo){for(var y,z=j/d.relatedTo.length,A=d.relatedTo.length-1;A>0;)h<A*z&&(y=A),A--;v=d.relatedTo[y];var B=y+":"+a.id+":"+n[f].id;t="allTargetTypesPossible",u="possibleTargetTypes",x=n[f].id,w=a.id}break;default:for(var C=0;C<o.length;C++)if((o[C].source===a.id&&o[C].target===n[f].id||o[C].source===n[f].id&&o[C].target===a.id)&&o[C].added){if(s[o[C].id]){for(var D=0;D<s[o[C].id].length;D++)i(s[o[C].id][D]);s[o[C].id]=void 0}r[n[f].id]=r[n[f].id]||{},r[n[f].id].id=r[n[f].id].id||"",o[C].dropped||(postMessage({msg:"removeNewEdge",edge:o[C].id}),o[C].dropped=!0,r[n[f].id].id===o[C].id&&(r[n[f].id].id=void 0))}}if(void 0!==v&&(v[t]===!0||v[u].split(",").indexOf(n[f].nodeType)>-1)){var E=!0;if("1"===v.sourceMultiplicity)for(var F=0;F<o.length&&(o[F].target!==x||o[F].relType!==v.type||(E=o[F].source!==w&&e(o[F],B),E));F++);if("1"===v.targetMultiplicity)for(var G=0;G<o.length&&(o[G].source!==w||o[G].relType!==v.type||(E=o[G].target!==x&&e(o[G],B),E));G++);if(r[n[f].id]=r[n[f].id]||{},r[n[f].id].id=r[n[f].id].id||"",r[n[f].id].id!==B&&E){var H,I;switch(k){case"to":H=a.id,I=n[f].id;break;case"from":H=n[f].id,I=a.id}var J={id:B,label:v.relationshipType,source:H,target:I,size:40,color:"#81ce25",type:"curvedArrow",added:!0,relType:v.type};postMessage({msg:"add",edge:J,remove:r[n[f].id].id}),r[n[f].id].id=B}}}void 0!==p&&void 0!==q&&(o=q,n=p,p=void 0,q=void 0)}}function e(a,b){var c=!0;return a.added?c=!1:a.hidden||(s[b]?(s[b].push(a),c=!1,h(a)):(s[b]=[],s[b].push(a),c=!0,h(a))),c}function f(a,b){for(var c=0;c<b.length;c++)if(b[c].added){if(s[b[c].id])for(var d=0;d<s[b[c].id].length;d++)i(s[b[c].id][d]);postMessage({msg:"removeNewEdge",edge:b[c].id})}s={},r={}}function g(a,b){var c=parseFloat(a["renderer1:x"]),d=parseFloat(a["renderer1:y"]),e=parseFloat(b["renderer1:x"]),f=parseFloat(b["renderer1:y"]),g=Math.sqrt(Math.pow(e-c,2)+Math.pow(f-d,2));return g}function h(a){a.hidden=!0,postMessage({msg:"hideEdge",edge:a.id})}function i(a){a.hidden=!1,postMessage({msg:"unhideEdge",edge:a.id})}function j(a){a.removed||(a.removed=!0,postMessage({msg:"removeNewEdge",edge:a.id}))}function k(a){if(s[a])for(var b=0;b<s[a].length;b++)j(s[a][b])}var l,m,n,o,p,q,r={},s={},t=function(a){var e=a.data.msg;switch(e){case"init":b(a.data.settings);break;case"updateGraphInfo":c(a.data.nodes,a.data.edges);break;case"handleDrag":d(a.data.dragedNode,a.data.keys,a.data.cameraRatio);break;case"removeNewEdges":f(a.data.nodes,a.data.edges);break;case"commitNewEdge":k(a.data.edge)}};this.addEventListener("message",t)};if("undefined"==typeof Graphbrowser.Modules.RelationshipEditor)throw"Graphbrowser.Modules.RelationshipEditor is not declared";Graphbrowser.Modules.RelationshipEditor.prototype.getRelationshipEditorWorker=a}.call(this);var Graphbrowser=Graphbrowser||{};Graphbrowser.Modules=Graphbrowser.Modules||{};var animating=animating||void 0;(function(){"use strict";var a,b,c,d=!1,e=0,f={};Graphbrowser.Modules.SelectionTools=function(c,e){var f=this;a=c,b=e,d=!1,f.name="selectionTools",f.isActive=!1},Graphbrowser.Modules.SelectionTools.prototype.init=function(a){var c=this;b.api.createSelectionGroup=c.createSelectionGroup.bind(c),b.api.deleteSelectionGroup=c.deleteSelectionGroup.bind(c),b.api.activateSelectionGroup=c.activateSelectionGroup.bind(c),b.api.hideSelectionGroup=c.hideSelectionGroup.bind(c),b.api.fixateSelectionGroup=c.fixateSelectionGroup.bind(c),b.api.clearSelectionGroup=c.clearSelectionGroup.bind(c),b.api.activateSelectionLasso=c.activateSelectionLasso.bind(c),b.api.deactivateSelectionTools=c.deactivateSelectionTools.bind(c),b.api.activateSelectionTools=c.activate.bind(c),b.api.selectionToolsActive=c.isActive,b.api.dropSelection=c.dropSelection.bind(c),b.bindBrowserEvent("restoreGraph",c.onRestore.bind(c))},Graphbrowser.Modules.SelectionTools.prototype.activate=function(){var d=this;d.isActive||(d.isActive=!0,a.renderers[0].bind("render",function(c){a.renderers[0].halo({nodes:b.sigmaPlugins.activeState.nodes()})}),b.sigmaPlugins.lasso.bind("selectedNodes",function(b){window.clearTimeout(e),e=setTimeout(function(){f[c].hidden&&d.hideSelectionGroup(c,!1),f[c].fixed&&d.fixateSelectionGroup(c,!1),b.data.length<=0||(f[c].nodes=b.data,d.activateSelectionLasso(!1),a.refresh({skipIndexation:!0}),d.updateActiveState(),e=0)},10)}),d.updateActiveState(),a.refresh({skipIndexation:!0}))},Graphbrowser.Modules.SelectionTools.prototype.createSelectionGroup=function(){var a=parseInt(4999*Math.random()).toString();return f[a]={id:a,nodes:[],hidden:!1,fixed:!1},c=a,a},Graphbrowser.Modules.SelectionTools.prototype.hideSelectionGroup=function(c,d){void 0!==d&&f[c].hidden!==d&&(f[c].hidden=d,b.eventEmitter[a.id].dispatchEvent("hideNodes",{nodes:f[c].nodes,status:d}))},Graphbrowser.Modules.SelectionTools.prototype.fixateSelectionGroup=function(b,c){void 0!==c&&f[b].fixed!==c&&(f[b].fixed=c,$.each(f[b].nodes,function(c,d){$.each(a.graph.nodes(),function(a,c){d.id===c.id&&(c.fixed=f[b].fixed,d.fixed=f[b].fixed)})}))},Graphbrowser.Modules.SelectionTools.prototype.clearSelectionGroup=function(c){var d=this;d.onHideSelectionGroup(c,!1),d.setSelectionFixed(c,!1),b.sigmaPlugins.activeState.dropNodes(),f[c].nodes=void 0,a.refresh({skipIndexation:!0})},Graphbrowser.Modules.SelectionTools.prototype.deleteSelectionGroup=function(a){var b=this;b.clearSelectionGroup(),f.splice(f.indexof(a),1)},Graphbrowser.Modules.SelectionTools.prototype.activateSelectionGroup=function(a){var b=this;b.isActive!==!1&&void 0!==a&&(c=a,b.updateActiveState())},Graphbrowser.Modules.SelectionTools.prototype.updateActiveState=function(){var d=this;if(d.isActive||void 0!==f[c].nodes){b.sigmaPlugins.activeState.dropNodes();var e=[];$.each(f[c].nodes,function(a,b){e.push(b.id)}),b.sigmaPlugins.activeState.addNodes(e),a.refresh({skipIndexation:!0})}},Graphbrowser.Modules.SelectionTools.prototype.activateSelectionLasso=function(a){b.sigmaPlugins.lasso.isActive||a!==!0?b.sigmaPlugins.lasso.deactivate():b.sigmaPlugins.lasso.activate()},Graphbrowser.Modules.SelectionTools.prototype.deactivateSelectionTools=function(c){var d=this;d.isActive&&(d.isActive=!1,b.sigmaPlugins.lasso.isActive&&d.activateSelectionLasso(!1),a.renderers[0].unbind("render"),b.sigmaPlugins.activeState.dropNodes(),b.refreshSigma(!0))},Graphbrowser.Modules.SelectionTools.prototype.deactivateSelectionTools=function(c){var d=this;d.isActive=!1,b.sigmaPlugins.lasso.isActive&&d.activateSelectionLasso(!1),a.renderers[0].unbind("render"),b.sigmaPlugins.activeState.dropNodes(),b.refreshSigma(!0)},Graphbrowser.Modules.SelectionTools.prototype.dropSelection=function(c){var d=f[c].nodes;void 0!==d&&d.length>0&&(b.sigmaPlugins.activeState.dropNodes(),$.each(d,function(b,c){a.graph.nodes(c.id)&&a.graph.dropNode(c.id)}),a.refresh(),$.each(f,function(b,c){var d=[];$.each(c.nodes,function(b,c){a.graph.nodes(c.id)||d.push(c.id)}),$.each(d,function(a,b){c.nodes.splice(c.nodes.indexOf(b),1)})}))},Graphbrowser.Modules.SelectionTools.prototype.onRestore=function(){var a=this;f=[],a.createNewSelectionGroup(),a.isActive&&(b.sigmaPlugins.activeState.dropNodes(),a.updateActiveState())}}).call(window);var Graphbrowser=Graphbrowser||{};Graphbrowser.Modules=Graphbrowser.Modules||{},function(){"use strict";var a,b,c,d=[];Graphbrowser.Modules.StatusUndo=function(c,d){var e=this;e.name="statusUndo",a=c,b=d},Graphbrowser.Modules.StatusUndo.prototype.init=function(d){var e=this;d&&d.activate&&(c=0,$(document).on("click","#statusUndo-controlElement",function(){e.undo()})),b.eventEmitter[a.id].bind("dataChanged",e.onDataChanged.bind(e)),b.bindBrowserEvent("start",e.start.bind(e)),b.bindBrowserEvent("status",e.status.bind(e)),b.bindBrowserEvent("reset",e.onReset.bind(e)),b.api.undo=e.undo.bind(e)},Graphbrowser.Modules.StatusUndo.prototype.start=function(){var a=this;a.onDataChanged(),c--},Graphbrowser.Modules.StatusUndo.prototype.onDataChanged=function(b){var e;if(e=b?b.data.source:"","undo"!==e){var f=JSON.parse(JSON.stringify(a.graph.nodes())),g=JSON.parse(JSON.stringify(a.graph.edges())),h=JSON.parse(JSON.stringify(a.camera));d.push({graph:{nodes:f,edges:g},camera:h}),c++}},Graphbrowser.Modules.StatusUndo.prototype.undo=function(){var e=[];if(d.length<=1)return void(c=0);c--,b.undo(),d.splice(d.length-1,1);var f=a.graph.edges();$.each(f,function(b,c){a.graph.dropEdge(c.id)}),$.each(a.graph.nodes(),function(b,c){var f=!1;$.each(d[d.length-1].graph.nodes,function(a,b){c.id===b.id&&(f=!0,c.to_x=b.x,c.to_y=b.y,e.push(c.id))}),f||a.graph.dropNode(c.id)}),$.each(d[d.length-1].graph.nodes,function(b,c){var d=!0;$.each(a.graph.nodes(),function(a,b){b.id===c.id&&(d=!1)}),d&&(a.graph.addNode(c),a.graph.nodes(c.id).x=c.x,a.graph.nodes(c.id).y=c.y)}),$.each(d[d.length-1].graph.edges,function(b,c){a.graph.addEdge(c)}),sigma.plugins.animate(a,{x:"to_x",y:"to_y"},{nodes:e,onComplete:function(){b.refreshSigma(!1,!1)},easing:"quadraticInOut",duration:800}),b.eventEmitter[a.id].dispatchEvent("dataChanged",{source:"undo"})},Graphbrowser.Modules.StatusUndo.prototype.status=function(){return c},Graphbrowser.Modules.StatusUndo.prototype.onReset=function(){var a=this;c=1,d.length>=2&&d.splice(2,d.length-2),a.undo()}}.call(window);var Graphbrowser=Graphbrowser||{};Graphbrowser.Modules=Graphbrowser.Modules||{},function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p=0,q=[],r=[];Graphbrowser.Modules.Swimlane=function(c,d){var e=this;e.name="swimlane",a=c,b=d},Graphbrowser.Modules.Swimlane.prototype.init=function(h){var i=this;if(void 0!==h){if(void 0!==h.critX&&"string"==typeof h.critX){var j=h.critX.split(".");c=j[0],e=j[1],n=j[2]}if(void 0!==h.critY&&"string"==typeof h.critY){var j=h.critY.split(".");d=j[0],f=j[1],o=j[2]}g=void 0!==h.view?h.view:"_graph",k=void 0!==h.nodesShape?h.nodesShape:"",l=void 0!==h.standardNodeShape?h.standardNodeShape:""}b.bindBrowserEvent("reset",i.reset.bind(i)),b.bindBrowserEvent("undo",i.undo.bind(i).bind(i)),b.bindBrowserEvent("doLayout",i.doLayout.bind(i)),b.eventEmitter[a.id].bind("dataChanged",i.onDataChanged.bind(i)),b.sigmaCtrl.bindSigmaEvent("startdrag",i.handleSigmaEvent.bind(i))},Graphbrowser.Modules.Swimlane.prototype.doLayout=function(l,m,r){var s=void 0;if(i=this,l===i.name){if(void 0!==m&&"object"==typeof m){h=m;var t=m.critX.split(".");c=t[0],e=t[1],n=t[2],t=m.critY.split("."),d=t[0],f=t[1],o=t[2],void 0!==m.view&&(g=m.view),void 0!==m.nodesShape&&(k=m.nodesShape||"")}r?($.each(a.graph.nodes(),function(a,b){$.each(q,function(a,g){if(b.id===g.id){var h=n||c,i=o||d;switch(e){case"string":void 0!==g[h]?b[c]=g[h]:b[c]="";break;case"date":void 0!==g[h]?b[c]=Date.parse(g[h]):b[c]=144e5;break;default:void 0!==g[h]?b[c]=g[h]:b[c]=0}switch(f){case"string":void 0!==g[i]?b[d]=g[i]:b[d]="";break;case"date":void 0!==g[i]?b[d]=Date.parse(g[i]):b[d]=144e5;break;default:void 0!==g[i]?b[d]=g[i]:b[d]=0}return!1}})}),s=sigma.layouts.swimlane.start(a,{critX:c,critY:d}),s.bind("stop",function(c){window.clearTimeout(p),p=window.setTimeout(function(){b.eventEmitter[a.id].dispatchEvent("dataChanged",{source:i.name}),k&&(CustomShapes.init(a),$.each(a.graph.nodes(),function(a,c){c.type=k,b.refreshSigma(!0,!1)}))},50)}),q=[],j=0):$.each(a.graph.nodes(),function(a,c){b.conn.getData(c,"node",i.loadDataForLayout.bind(i),g)})}},Graphbrowser.Modules.Swimlane.prototype.loadDataForLayout=function(a,b){var e=this;if(void 0!==a)q.push(a);else{var f={id:b.id};f[c]=c+" empty",f[d]=d+" empty",q.push(f)}window.clearTimeout(j),j=window.setTimeout(function(){e.doLayout(e.name,void 0,!0)},100)},Graphbrowser.Modules.Swimlane.prototype.reset=function(){m=l||"",this.kill(!0)},Graphbrowser.Modules.Swimlane.prototype.handleSigmaEvent=function(a){m=l||"",this.kill(!1)},Graphbrowser.Modules.Swimlane.prototype.onDataChanged=function(a){var b=a.data.source;if("undo"!==b){var c;c=void 0===d?"":new String(d),b!==this.name?(r.push({self:!1,critY:c.toString()}),this.kill()):r.push({self:!0,critY:c.toString()})}},Graphbrowser.Modules.Swimlane.prototype.undo=function(){var b=this;if(r.length<=1)m=l,b.kill(!0);else{r.splice(r.length-1,1);var c=r[r.length-1].critY||"";r[r.length-1].self===!0?(m=k,sigma.layouts.swimlane.showGrid(a,{critY:c}),$.each(a.graph.nodes(),function(a,b){b.type=m})):(m=l,b.kill(!1))}},Graphbrowser.Modules.Swimlane.prototype.kill=function(c){sigma.layouts.swimlane&&(sigma.layouts.swimlane.kill(a),$.each(a.graph.nodes(),function(a,b){b.type=m}),b.refreshSigma(!1,!1),c&&(r=[]))}}.call(window);var Graphbrowser=Graphbrowser||{};Graphbrowser.Modules=Graphbrowser.Modules||{},function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=!1,r=!1;Graphbrowser.Modules.Toolstips=function(c,d){var e=this;e.name="tooltips",a=c,b=d},Graphbrowser.Modules.Toolstips.prototype.init=function(s){var t=this;if(void 0!==s){s.node&&(q=!0,g=void 0!==s.node.showOn?s.node.showOn:"rightClickNode",h=void 0!==s.node.hideOn?s.node.hideOn:"clickStage",j=void 0!==s.node.position?s.node.position:"bottom",i=void 0!==s.node.cssClass?s.node.cssClass:"node-tooltip-container",k=void 0!==s.node.renderer&&"function"==typeof s.node.renderer?s.node.renderer:void 0),s.edge&&(r=!0,l=void 0!==s.edge.showOn?s.edge.showOn:"rightClickEdge",m=void 0!==s.edge.hideOn?s.edge.hideOn:"clickStage",o=void 0!==s.edge.position?s.edge.position:"bottom",n=void 0!==s.edge.cssClass?s.edge.cssClass:"edge-tooltip-container",p=void 0!==s.edge.renderer&&"function"==typeof s.edge.renderer?s.edge.renderer:void 0),d=void 0!==s.page?s.page:void 0,e=void 0!==s.onShow&&"function"==typeof s.onShow?s.onShow:void 0,f=void 0!==s.onError&&"function"==typeof s.onError?s.onError:void 0;var u={};q&&(u.node={show:g,hide:h,position:j,template:'<div id="node-tooltip-container" class="'+i+'"></div>',renderer:function(a,b){return k?k(a):(t.loadStructrPageContent(a),"")}}),r&&(u.edge={show:l,hide:m,position:o,template:'<div id="edge-tooltip-container" class="'+n+'"></div>',renderer:function(a,b){return p?p(a):(t.loadStructrPageContent(a),"")}}),c=sigma.plugins.tooltips(a,a.renderers[0],u)}b.api.closeTooltip=t.closeTooltip.bind(t)},Graphbrowser.Modules.Toolstips.prototype.closeTooltip=function(){c.close()},Graphbrowser.Modules.Toolstips.prototype.loadStructrPageContent=function(a){var c=this;d?b.conn.getStructrPage(d,a.id,c.onContentLoaded,f):k&&c.onContentLoaded(k(a),node.id)},Graphbrowser.Modules.Toolstips.prototype.onContentLoaded=function(a,b){$("#tooltip-container").append(a),$(document).on("click","#tooltip-btnCloseTooltip-"+b,function(){c.close()}),void 0!==e&&e(node)}}.call(window);var Graphbrowser=Graphbrowser||{};Graphbrowser.Modules=Graphbrowser.Modules||{};var animating=animating||void 0;(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l=!1,m=!1,n=[],o=[],p=[],q=!1;Graphbrowser.Modules.ZoomExpander=function(c,d){var e=this;e.name="zoomExpander",a=c,b=d},Graphbrowser.Modules.ZoomExpander.prototype.init=function(a){var b=this;a&&(c=void 0!==a.margins.left?a.margins.left:0,d=void 0!==a.margins.top?a.margins.top:0,e=void 0!==a.onAddNodes?a.onAddNodes:void 0,f=void 0!==a.onNodesAdded?a.onNodesAdded:void 0,g=void 0!==a.onNodesRemoved?a.onNodesRemoved:void 0,h=void 0!==a.newNodesSize?a.newNodesSize:10,j=void 0!==a.newEdgesSize?a.newEdgesSize:10,i=void 0!==a.edgeType?a.edgeType:"arrow",b.bindEvents())},Graphbrowser.Modules.ZoomExpander.prototype.bindEvents=function(){var a=this;b.sigmaCtrl.bindSigmaEvent("clickNode",a.handleClickNodeEvent.bind(a)),b.sigmaCtrl.bindSigmaEvent("doubleClickNode",a.handleDoubleClickNodeEvent.bind(a)),b.sigmaCtrl.bindSigmaEvent("hovers",a.handleHoversEvent.bind(a)),b.sigmaCtrl.bindSigmaEvent("mousewheel",a.handleZoom.bind(a))},Graphbrowser.Modules.ZoomExpander.prototype.unbindEvents=function(){var a=this;b.sigmaCtrl.unbindSigmaEvent("clickNode",a.handleClickNodeEvent.bind(a)),b.sigmaCtrl.unbindSigmaEvent("doubleClickNode",a.handleDoubleClickNodeEvent.bind(a)),b.sigmaCtrl.unbindSigmaEvent("hovers",a.handleHoversEvent.bind(a)),b.sigmaCtrl.unbindSigmaEvent("mousewheel",a.handleZoom.bind(a))},Graphbrowser.Modules.ZoomExpander.prototype.handleZoom=function(b){var c=this,d=a.camera.ratio;d<1&&q===!1?(a.settings("maxNodeSize",50),q=!0):d>=1&&q===!0&&(a.settings("maxNodeSize",25),q=!1),d<=.0625&&(p.push(a.graph),a.settings("maxNodeSize",25),c.onExpandNode(k,b.data.captor.x,b.data.captor.y)),a.refresh({skipIndexation:!0})},Graphbrowser.Modules.ZoomExpander.prototype.handleClickNodeEvent=function(a){a.data.node},Graphbrowser.Modules.ZoomExpander.prototype.handleDoubleClickNodeEvent=function(a){a.data.node},Graphbrowser.Modules.ZoomExpander.prototype.handleHoversEvent=function(a){var b=this;a.data.enter.nodes.length>0?b.handleOverNodeEvent(a.data.enter.nodes[0]):a.data.leave.nodes.length>0},Graphbrowser.Modules.ZoomExpander.prototype.handleOverNodeEvent=function(a){var c=this;k=a,n={};b.conn.getNodes(a,"in",c.onNewInNodesLoaded.bind(c)),b.conn.getNodes(a,"out",c.onNewOutNodesLoaded.bind(c))},Graphbrowser.Modules.ZoomExpander.prototype.handleOutNodeEvent=function(a){},Graphbrowser.Modules.ZoomExpander.prototype.onNewOutNodesLoaded=function(a,c){m=!0,a=b.filterNodes(a,"out"),n.outNodes=a},Graphbrowser.Modules.ZoomExpander.prototype.onNewInNodesLoaded=function(a,c){l=!0,a=b.filterNodes(a,"in"),n.inNodes=a},Graphbrowser.Modules.ZoomExpander.prototype.onExpandNode=function(a,b,c){var d=this;if(n.inNodes||n.outNodes){var e=[],f=[];$.each(n.outNodes,function(a,b){d.addOutNode(e,f,b,0,0)}),$.each(n.inNodes,function(a,b){d.addInNode(e,f,b,0,0)}),d.addNodesToGraph(e,f,b,c)}},Graphbrowser.Modules.ZoomExpander.prototype.addOutNode=function(b,c,d,e,f){var g=d.sourceNode,k=d.targetNode,l=Math.random()*Math.PI*2,m=e+Math.cos(l),n=f+Math.sin(l),o=h;b.push({id:k.id,label:k.name,size:o,x:m,y:n,color:color[k.type],
nodeType:k.type}),c.push({id:d.id,source:g.id,target:k.id,size:j,relType:d.type,label:d.relType,type:i,color:a.settings("defaultEdgeColor")})},Graphbrowser.Modules.ZoomExpander.prototype.addInNode=function(b,c,d,e,f){var g=d.sourceNode,k=d.targetNode,l=Math.random()*Math.PI*2,m=e+Math.cos(l),n=f+Math.sin(l),o=h;b.push({id:g.id,label:g.name,size:o,x:m,y:n,color:color[g.type],nodeType:g.type}),c.push({id:d.id,source:g.id,target:k.id,size:j,relType:d.type,label:d.relType,type:i,color:a.settings("defaultEdgeColor")})},Graphbrowser.Modules.ZoomExpander.prototype.addEdge=function(b){var c=b.sourceNode,d=b.targetNode;b.id;edges[b.id]={id:b.id,source:c.id,target:d.id,size:j,relType:b.type,label:b.relType,type:i,color:a.settings("defaultEdgeColor")}},Graphbrowser.Modules.ZoomExpander.prototype.addNodesToGraph=function(c,d,e,g){var h=this;a.graph.clear(),$.each(c,function(b,c){try{a.graph.addNode({id:c.id,label:c.label,size:c.size,x:c.x,y:c.y,color:c.color,nodeType:c.nodeType})}catch(d){console.log(d)}}),n=[],o=[],a.settings("maxNodeSize",25),q=!1;sigma.misc.animation.camera(a.camera,{x:0,y:0,ratio:2},{easing:"quadraticInOut",duration:1e3});a.refresh({skipIndexation:!0}),b.doLayout("swimlane",{view:"ui",critX:"name.string",critY:"nodeType.string.type"}),b.eventEmitter[a.id].dispatchEvent("dataChanged",{source:h.name}),void 0!==f&&"function"==typeof f&&f()},Graphbrowser.Modules.ZoomExpander.prototype.expandNode=function(c){var d=this,e=a.graph.nodes(c);_showHoverInfo=!1;b.conn.getNodes(e,"in",d.onNewInNodesLoaded.bind(d)),b.conn.getNodes(e,"out",d.onNewOutNodesLoaded.bind(d));window.setTimeout(function(){d.onExpandNode(e)},20)}}).call(window);