/* Sigma Fruchterman-Reingold - Version: 0.1 - Author: SÃ©bastien Heymann @ Linkurious - License: MIT */
(function(){"use strict";function i(){var i=this;this.init=function(i,n){if(n=n||{},this.sigInst=i,this.config=sigma.utils.extend(n,t),this.easing=n.easing,this.duration=n.duration,!sigma.plugins||"undefined"==typeof sigma.plugins.animate)throw new Error("sigma.plugins.animate is not declared");this.started=!1,this.running=!1},this.atomicGo=function(){if(!this.running||this.iterCount<1)return!1;var t,n,r,s,e,a,f,g,o,h=this.sigInst.graph.nodes(),u=this.sigInst.graph.edges(),d=h.length,l=u.length;this.config.area=this.config.autoArea?d*d:this.config.area,this.iterCount--,this.running=this.iterCount>0;var c=Math.sqrt(this.config.area)/10,y=Math.sqrt(this.config.area/(1+d));for(t=0;d>t;t++)for(r=h[t],r.fr||(r.fr_x=r.x,r.fr_y=r.y,r.fr={dx:0,dy:0}),n=0;d>n;n++)s=h[n],r.id!=s.id&&(a=r.fr_x-s.fr_x,f=r.fr_y-s.fr_y,g=Math.sqrt(a*a+f*f)+.01,g>0&&(o=y*y/g,r.fr.dx+=a/g*o,r.fr.dy+=f/g*o));var m,p,x;for(t=0;l>t;t++)e=u[t],m=i.sigInst.graph.nodes(e.source),p=i.sigInst.graph.nodes(e.target),a=m.fr_x-p.fr_x,f=m.fr_y-p.fr_y,g=Math.sqrt(a*a+f*f)+.01,x=g*g/y,g>0&&(m.fr.dx-=a/g*x,m.fr.dy-=f/g*x,p.fr.dx+=a/g*x,p.fr.dy+=f/g*x);var _,I,v;for(t=0;d>t;t++)r=h[t],_=Math.sqrt(r.fr_x*r.fr_x+r.fr_y*r.fr_y),I=.01*y*i.config.gravity*_,r.fr.dx-=I*r.fr_x/_,r.fr.dy-=I*r.fr_y/_,r.fr.dx*=i.config.speed,r.fr.dy*=i.config.speed,r.fixed||(a=r.fr.dx,f=r.fr.dy,g=Math.sqrt(a*a+f*f),g>0&&(v=Math.min(c*i.config.speed,g),r.fr_x+=a/g*v,r.fr_y+=f/g*v));return this.running},this.go=function(){for(this.iterCount=this.config.iterations;this.running;)this.atomicGo();this.stop()},this.start=function(){if(!this.running){var t=this.sigInst.graph.nodes();if(this.running=!0,!this.started){for(var n=0;n<t.length;n++)t[n].fr_x=t[n].x,t[n].fr_y=t[n].y,t[n].fr={dx:0,dy:0};this.started=!0,r[i.sigInst.id].dispatchEvent("start"),this.go()}}},this.stop=function(){var t=this.sigInst.graph.nodes();if(this.running=!1,r[i.sigInst.id].dispatchEvent("stop"),this.easing)r[i.sigInst.id].dispatchEvent("interpolate"),sigma.plugins.animate(i.sigInst,{x:"fr_x",y:"fr_y"},{easing:i.easing,onComplete:function(){i.sigInst.refresh();for(var n=0;n<t.length;n++)t[n].fr=null,t[n].fr_x=null,t[n].fr_y=null;r[i.sigInst.id].dispatchEvent("stop")},duration:i.duration});else{for(var n=0;n<t.length;n++)t[n].x=t[n].fr_x,t[n].y=t[n].fr_y;this.sigInst.refresh();for(var n=0;n<t.length;n++)t[n].fr=null,t[n].fr_x=null,t[n].fr_y=null}},this.kill=function(){this.sigInst=null,this.config=null,this.easing=null}}if("undefined"==typeof sigma)throw new Error("sigma is not declared");sigma.utils.pkg("sigma.layouts.fruchtermanReingold");var t={autoArea:!0,area:1,gravity:10,speed:.1,iterations:1e3},n={},r={};sigma.layouts.fruchtermanReingold.configure=function(t,s){if(!t)throw new Error('Missing argument: "sigInst"');if(!s)throw new Error('Missing argument: "config"');return n[t.id]||(n[t.id]=new i,r[t.id]={},sigma.classes.dispatcher.extend(r[t.id]),t.bind("kill",function(){n[t.id].kill(),n[t.id]=null,r[t.id]=null})),n[t.id].init(t,s),r[t.id]},sigma.layouts.fruchtermanReingold.start=function(i,t){if(!i)throw new Error('Missing argument: "sigInst"');return t&&this.configure(i,t),n[i.id].start(),r[i.id]},sigma.layouts.fruchtermanReingold.isRunning=function(i){if(!i)throw new Error('Missing argument: "sigInst"');return!!n[i.id]&&n[i.id].running},sigma.layouts.fruchtermanReingold.progress=function(i){if(!i)throw new Error('Missing argument: "sigInst"');return(n[i.id].config.iterations-n[i.id].iterCount)/n[i.id].config.iterations}}).call(this);
